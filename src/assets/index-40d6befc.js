import{b as e,u as a,e as t,r as i,j as s,S as l,B as r,m as o,h as d,T as n}from"./index-aeca932e.js";import{F as u}from"./index-85dc0d3a.js";import{I as m}from"./index-d90fa46f.js";import{a as p}from"./index-801a9590.js";import"./index-d93151a5.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{D as c}from"./index-a0588428.js";import{D as x}from"./index-d88d2b2a.js";import"./index-57f63cdf.js";import{u as h}from"./user-a3dc1d16.js";import{o as y}from"./order-e3583410.js";import{q as j}from"./qiang-81fb4cfe.js";import{u as v}from"./useSetState-8e08c7f5.js";import{M as g}from"./index-6226197c.js";import{S}from"./SearchOutlined-fa850377.js";import{E as f}from"./EyeOutlined-d33bc3ff.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-4a60c0a0.js";import"./CalendarOutlined-8ff6678f.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";const{RangePicker:w}=x;function b(){const{t:x}=e();document.title="订单列表";const b=a(),T=t((e=>e.app.powersCode)),[N]=u.useForm(),[C,k]=i.useState([]),[I,O]=i.useState(!1),[z,D]=v({pageNum:1,pageSize:10,total:0}),[L,Y]=v({operateType:"apply",nowData:null,modalShow:!1,modalLoading:!1}),[E,F]=v({title:void 0,provideruuid:void 0,storeuuid:void 0,storeType:void 0,storeState:void 0,storeProxy:void 0,startTime:void 0,endTime:void 0,ordersearch:void 0,actualmount:void 0}),M=async e=>{const a={page:e.pageNum,limit:e.pageSize,provideruuid:E.provideruuid,storeuuid:E.storeuuid,title:E.title,property:E.storeType,status:E.storeState,starttime:E.startTime,endtime:E.endTime,ordersearch:E.ordersearch,actualmount:E.actualmount};O(!0);try{const t=await y.OrderList(a);t&&200===t.code?(k(t.data),D({total:t.cont,pageNum:e.pageNum,pageSize:e.pageSize})):o.error((null==t?void 0:t.message)??x("dataFetchFailed"))}finally{O(!1)}},P=[{value:0,label:"拼场"},{value:1,label:"整场"},{value:2,label:"活动"},{value:3,label:"课程"}],A=e=>{const a=P.find((a=>a.value===e));return a?a.label:""},[V,$]=i.useState([]),[q,B]=i.useState([]),[Q,R]=i.useState(""),U=()=>{N.setFieldsValue({rolename:"",proxy:"",store:"",desc:"",limit:"",activityOptions:"",orderStatusOptions:""}),Y({modalShow:!1})},H=[{value:0,label:"待付款"},{value:1,label:"已支付"},{value:2,label:"已完成"},{value:3,label:"已取消"},{value:4,label:"已退款"}],J=e=>{const a=H.find((a=>a.value===e));return a?a.label:""},W=[{title:"订单编号",dataIndex:"uuid",key:"uuid"},{title:"类型",dataIndex:"storeType",key:"storeType"},{title:"门店名称",dataIndex:"title",key:"title"},{title:"所属代理",dataIndex:"proxy",key:"proxy"},{title:"项目名称",dataIndex:"name",key:"name"},{title:"时间",dataIndex:"time",key:"time"},{title:"顾客",dataIndex:"user",key:"user"},{title:"顾客手机号",dataIndex:"userTel",key:"userTel"},{title:"订单金额",dataIndex:"actualmount",key:"actualmount"},{title:"订单状态",dataIndex:"storeState",key:"storeState"},{title:"实收金额",dataIndex:"price",key:"price"},{title:"订单创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"control",render:(e,a)=>{const t=[];T.includes("order:detail")&&t.push(s.jsx("span",{className:"control-btn blue",onClick:()=>{return e=a,void("detail"==="detail"&&b(`/order/detail?order=${null==e?void 0:e.uuid}`));var e},children:s.jsx(n,{placement:"top",title:"详情",children:s.jsx(f,{})})},"1"));const i=[];return t.forEach(((e,a)=>{a&&i.push(s.jsx(c,{type:"vertical"},`line${a}`)),i.push(e)})),i}}],X=i.useMemo((()=>C.map(((e,a)=>({key:e.id,uuid:e.uuid,serial:a+1+(z.pageNum-1)*z.pageSize,title:e.storename,storeType:A(e.property),name:e.prodname,time:e.orderpool[0].showtime,proxy:e.providername,createTime:e.addtime,user:e.username,userTel:e.usermob,storeState:J(e.status),price:e.actualmount,actualmount:e.actualmount})))),[z,C]),[Z,_]=i.useState("");i.useEffect((()=>{M(z),(async()=>{const e=(await h.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));$(e)})()}),[]);const G={emptyText:x("noDataAvailable")};return s.jsxs("div",{className:"store-list-box",children:[s.jsx("div",{className:"g-search",children:s.jsxs("ul",{className:"search-ul",children:[s.jsxs("li",{className:"search-item",children:[s.jsxs("span",{className:"item-lable",style:{width:"60px"},children:["选择代理:"," "]}),s.jsx(l,{placeholder:"请选择代理",allowClear:!0,style:{width:"100px"},onChange:async e=>{F({provideruuid:e,storeuuid:void 0});const a=(await h.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));B(a)},value:E.storeProxy,options:V})]}),s.jsxs("li",{className:"search-item",children:[s.jsx("span",{className:"item-lable",style:{width:"65px"},children:"门店名称:"}),s.jsx(l,{placeholder:"请选择名称",allowClear:!0,style:{width:"100px"},onChange:e=>{F({storeuuid:e})},value:E.storeuuid,options:q})]}),s.jsxs("li",{className:"search-item",children:[s.jsx("span",{className:"item-lable",style:{width:"65px"},children:"选择类型:"}),s.jsx(l,{placeholder:"请选择类型",allowClear:!0,style:{width:"100px"},onChange:e=>{F({storeType:e})},value:E.storeType,options:P})]}),s.jsxs("li",{className:"search-item",children:[s.jsx("span",{className:"item-lable",style:{width:"65px"},children:"订单状态:"}),s.jsx(l,{placeholder:"请选择状态",allowClear:!0,style:{width:"90px"},onChange:e=>{F({storeState:e})},value:E.storeState,options:H,defaultValue:void 0})]}),s.jsxs("li",{className:"search-item",children:[s.jsx("span",{className:"item-lable",style:{width:"50px"},children:"日期:"}),s.jsx(w,{style:{width:"190px"},onChange:e=>{F(e?{startTime:d(e[0]).format("YYYY-MM-DD"),endTime:d(e[1]).format("YYYY-MM-DD")}:{startTime:void 0,endTime:void 0})}})]}),s.jsx("li",{children:s.jsx(m,{placeholder:"请输入订单号/顾客手机号",onChange:e=>{R(e.target.value),F({...E,ordersearch:e.target.value})},value:Q,style:{width:"190px"}})}),T.includes("order:search")&&s.jsx("li",{children:s.jsx(r,{type:"primary",icon:s.jsx(S,{}),onClick:()=>{M(z)},children:"搜索"})}),T.includes("order:apply")&&s.jsx("li",{children:s.jsx(r,{type:"primary",disabled:!T.includes("order:apply"),onClick:()=>{Y({modalShow:!0,nowData:null,operateType:"apply"})},children:"快速核销"})})]})}),s.jsx("div",{className:"diy-table",children:s.jsx(p,{columns:W,loading:I,locale:G,dataSource:X,pagination:{total:z.total,current:z.pageNum,pageSize:z.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,a)=>((e,a)=>{M({pageNum:e,pageSize:a||z.pageSize})})(e,a)}})}),s.jsxs(g,{open:L.modalShow,footer:null,onCancel:()=>U(),confirmLoading:L.modalLoading,children:[s.jsxs(u,{form:N,initialValues:{formConditions:1},style:{paddingTop:30,display:"flex"},children:[s.jsx(m,{placeholder:"请输入订单编号",onChange:e=>{_(e.target.value)},value:Z}),s.jsx(r,{type:"primary",onClick:async()=>{const e={orderuuid:Z};Y({modalLoading:!0});try{const a=await y.OrderHave(e);if(a&&200===a.code){o.success("订单存在");try{const e={orderuuid:Z},a=await y.OrderLeave(e);a&&200===a.code?(o.success("订单核销成功"),U()):o.error((null==a?void 0:a.message)??"订单核销不成功")}finally{Y({modalLoading:!1})}}else o.error((null==a?void 0:a.message)??"订单不存在")}finally{Y({modalLoading:!1})}},style:{marginLeft:10},children:"搜索"})]}),s.jsx("p",{style:{width:"120px",height:"300px",margin:"auto",padding:"50px 0"},children:s.jsx("img",{src:j,alt:"",style:{width:"100%",height:"100%"}})}),s.jsx("p",{style:{textAlign:"center"},children:"请顾客使用签到码，可使用扫码枪扫码识别"})]})]})}export{b as default};

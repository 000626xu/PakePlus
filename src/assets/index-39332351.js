import{b as e,u as t,e as s,r as a,k as l,m as i,j as n,T as o,S as r,B as d}from"./index-aeca932e.js";import{F as c}from"./index-85dc0d3a.js";import{I as p}from"./index-d90fa46f.js";import{a as u}from"./index-801a9590.js";import"./index-d93151a5.js";import"./index-5a025839.js";import{R as m}from"./index-fb057fd6.js";import{D as h}from"./index-a0588428.js";/* empty css              */import{P as x}from"./index-60197fbb.js";import{I as j}from"./index-c30e6708.js";import{h as g}from"./hado-2bd80816.js";import{u as w}from"./useSetState-8e08c7f5.js";import{M as v}from"./index-6226197c.js";import{U as y}from"./index-af455608.js";import{E as f}from"./EditOutlined-21831c3e.js";import{D as b}from"./DeleteOutlined-c2326a92.js";import{S}from"./SearchOutlined-fa850377.js";import{P as k}from"./PlusCircleOutlined-90803570.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-4a60c0a0.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";import"./DeleteOutlined-6b999003.js";function N(){const{t:N}=e();document.title="HADO CRM",t();const T=s((e=>e.app.powersCode)),[C]=c.useForm(),[I,F]=a.useState([]),[L,z]=a.useState(!1),[E,D]=w({pageNum:1,pageSize:10,total:0}),[O,q]=w({newslocate:void 0,status:void 0}),P=async e=>{const t={page:e.pageNum,limit:e.pageSize,newslocate:O.newslocate,status:O.status,continentid:4};z(!0);try{const s=await g.newsList(t);s&&200===s.code?(F(s.data),D({pageNum:e.pageNum,pageSize:e.pageSize,total:s.cont})):i.error((null==s?void 0:s.message)??N("dataFetchFailed"))}finally{z(!1)}};a.useState();a.useState();const[B,U]=a.useState([]),[V,A]=w({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),[$,M]=a.useState(0),R=(e,t)=>{if(A({modalShow:!0,nowData:e,operateType:t}),e){const t={uid:Date.now(),name:"image.png",status:"done",url:e.picurl};H([t]),C.setFieldsValue({newsTitle:e.newsTitle,position:e.location,tag:e.label,cover:e.cover,link:e.connect,status:Z(e.status)})}else C.setFieldsValue({..._})},_={newsTitle:"",position:"",tag:"",cover:"",link:"",status:0},Q=()=>{A({modalShow:!1}),C.setFieldsValue({..._}),H([])},[G,H]=a.useState([]),J={accept:".jpg,.png,",action:`${l}service_api/file_upload`,headers:{Authorization:localStorage.getItem("token")},beforeUpload:e=>{const t=e.size/1024/1024<5;return t||i.error(N("imageSizeLimit")),t},onChange({file:e,fileList:t}){e.status,H(t)},fileList:G,maxCount:1},X=[{title:N("number"),dataIndex:"serial",key:"serial"},{title:N("newsTitle"),dataIndex:"newsTitle",key:"newsTitle",width:200,render:(e,t)=>n.jsx(n.Fragment,{children:n.jsx(o,{placement:"top",title:t.newsTitle,children:n.jsx("span",{className:"title",children:t.newsTitle})})})},{title:N("publishLocation"),dataIndex:"location",key:"location"},{title:N("tags"),dataIndex:"label",key:"label"},{title:N("cover"),dataIndex:"cover",key:"cover",render:(e,t)=>{const s=[];T.includes("hado:log")&&s.push(n.jsx("span",{className:"control-btn blue",onClick:()=>ae(t),children:N("view")},"1"));const a=[];return s.forEach(((e,t)=>{t&&a.push(n.jsx(h,{type:"vertical"},`line${t}`)),a.push(e)})),a}},{title:N("link"),dataIndex:"connect",key:"connect",width:300,render:(e,t)=>n.jsx(n.Fragment,{children:n.jsx(o,{placement:"top",title:t.connect,children:n.jsx("span",{className:"link",children:t.connect})})})},{title:N("status"),dataIndex:"status",key:"status"},{title:N("updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:N("action"),key:"control",width:150,render:(e,t)=>{const s=[];T.includes("applet:edit")&&s.push(n.jsx("span",{className:"control-btn blue",onClick:()=>R(t,"edit"),children:n.jsx(o,{placement:"top",title:N("view"),children:n.jsx(f,{})})},"1")),T.includes("applet:del")&&s.push(n.jsx(x,{title:N("delete"),onConfirm:()=>(async e=>{try{const t={id:e.key},s=await g.deleteNews(t);s&&200===s.code?(i.success("success"),1===I.length&&E.pageNum>1?P({pageNum:E.pageNum-1,pageSize:E.pageSize}):P(E)):i.error((null==s?void 0:s.message)??"error")}finally{z(!1)}})(t),okText:N("confirm"),cancelText:N("cancel"),children:n.jsx("span",{className:"control-btn red",children:n.jsx(o,{placement:"top",title:N("delete"),children:n.jsx(b,{})})})},"field:del"));const a=[];return s.forEach(((e,t)=>{t&&a.push(n.jsx(h,{type:"vertical"},`line${t}`)),a.push(e)})),a}}],Y={0:N("listed"),1:N("delisted"),2:N("delete")},Z=e=>{switch(e){case N("listed"):return 0;case N("delisted"):return 1;case N("delete"):return 2;default:return 0}},K=a.useMemo((()=>I.map(((e,t)=>({key:e.id,serial:e.id,newsTitle:e.newstitle,location:e.newslocatename,label:e.newstag,cover:e.picurl,connect:e.contenturl,status:Y[e.status],updateTime:e.updated})))),[E,I]),[W,ee]=a.useState(!1),[te,se]=a.useState(""),ae=e=>{ee(!0),se(e.cover)};a.useEffect((()=>{P(E),(async()=>{const e=(await g.newsPosition({uuid:""})).data.map((e=>({value:e.type,label:e.name})));U(e)})()}),[]);const le={emptyText:N("noDataAvailable")};return n.jsxs("div",{className:"gameList",children:[T.includes("applet:add")?n.jsxs("div",{className:"btnBox",children:[n.jsxs("div",{className:"btnBoxItem",children:[n.jsxs("div",{children:[n.jsxs("span",{className:"item-lable",style:{width:"60px"},children:[N("publishLocation"),"："]}),n.jsx(r,{placeholder:N("pleaseSelect"),style:{width:150},allowClear:!0,options:B,onChange:e=>{q({newslocate:e})}})]}),n.jsxs("div",{style:{marginLeft:30},children:[n.jsxs("span",{className:"item-lable",style:{width:"60px"},children:[N("selectStatus"),"："]}),n.jsx(r,{placeholder:N("pleaseSelect"),style:{width:"150px"},onChange:e=>{q({status:e})},allowClear:!0,options:[{value:0,label:N("listed")},{value:1,label:N("delisted")}]})]})]}),n.jsxs("div",{children:[T.includes("applet:search")&&n.jsx(d,{type:"primary",icon:n.jsx(S,{}),onClick:()=>{P(E)},className:"btn",children:N("search")}),n.jsxs(d,{type:"primary",className:"btn",onClick:()=>R(null,"add"),children:[n.jsx(k,{}),N("addNews")]})]})]}):n.jsx(n.Fragment,{}),n.jsx("div",{className:"diy-table",children:n.jsx(u,{columns:X,loading:L,locale:le,dataSource:K,pagination:{total:E.total,current:E.pageNum,pageSize:E.pageSize,showQuickJumper:!1,showTotal:e=>N("dataNumber",{count:e}),onChange:(e,t)=>((e,t)=>{P({pageNum:e,pageSize:t||E.pageSize})})(e,t)}})}),n.jsx(v,{title:{add:N("addNews"),edit:N("editNews")}[V.operateType],open:V.modalShow,onOk:async()=>{var e,t,s,a,l,n,o,r,d;try{const p=await C.validateFields();if(A({modalLoading:!0}),"add"===V.operateType)try{const a={newstitle:p.newsTitle,newstag:p.tag,newslocate:null==p?void 0:p.position,picurl:null==(s=null==(t=null==(e=p.cover)?void 0:e.file)?void 0:t.response)?void 0:s.data,contenturl:p.link?p.link:"",status:p.status,continentid:4},l=await g.addNews(a);l&&200===l.code?(i.success("success"),P(E),Q()):i.error((null==l?void 0:l.message)??"error")}finally{A({modalLoading:!1})}else try{const e=B.find((e=>e.value===p.position||e.label===p.position)),t=null==e?void 0:e.value,s={id:V.nowData.key,newstitle:p.newsTitle,newstag:p.tag,newslocate:t,picurl:(null==(n=null==(l=null==(a=p.cover)?void 0:a.file)?void 0:l.response)?void 0:n.data)?null==(d=null==(r=null==(o=p.cover)?void 0:o.file)?void 0:r.response)?void 0:d.data:p.cover,contenturl:p.link?p.link:"",status:p.status,continentid:4},c=await g.editNews(s);200===(null==c?void 0:c.code)?(i.success("success"),Q()):i.error((null==c?void 0:c.message)??"error")}catch(c){}finally{A({modalLoading:!1})}P(E)}catch{}},onCancel:Q,okText:N("uploadFile"),cancelText:N("cancel"),children:n.jsxs(c,{labelCol:{span:7},wrapperCol:{span:16},form:C,children:[n.jsx(c.Item,{name:"newsTitle",label:N("newsTitle"),rules:[{required:!0,message:N("pleaseEnter")}],children:n.jsx(p,{placeholder:N("pleaseEnter")})}),n.jsx(c.Item,{name:"position",label:N("publishLocation"),rules:[{required:!0,message:N("pleaseSelect")}],children:n.jsx(r,{placeholder:N("pleaseSelect"),style:{width:120},allowClear:!0,options:B})}),n.jsx(c.Item,{name:"tag",label:N("tags"),rules:[{required:!0,message:N("pleaseEnter")}],children:n.jsx(p,{placeholder:N("pleaseEnterNumber",{num:4}),maxLength:4})}),n.jsx(c.Item,{name:"cover",label:N("cover"),rules:[{required:!0,message:N("pleaseUpload")}],children:n.jsxs(y,{...J,children:[n.jsx(d,{children:N("uploadFile")}),n.jsx("span",{style:{marginLeft:10},children:N("tips1",{num:5})})]})}),n.jsx(c.Item,{name:"link",label:N("link"),children:n.jsx(p,{placeholder:N("pleaseEnter")})}),n.jsx(c.Item,{name:"status",label:N("listed"),rules:[{required:!0}],children:n.jsxs(m.Group,{onChange:e=>{M(e.target.value)},value:$,children:[n.jsx(m,{value:0,children:N("listed")}),n.jsx(m,{value:1,children:N("delisted")})]})})]})}),n.jsx(j,{style:{display:"none"},src:te,preview:{visible:W,onVisibleChange:e=>{ee(e)}}})]})}export{N as default};

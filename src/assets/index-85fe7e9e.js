import{r as e,o as a,p as s,q as t,s as l,v as i,K as n,C as o,w as r,x as d,W as c,_ as u,L as m,b as p,g as x,j as h,B as v,h as j,S as b,m as f}from"./index-aeca932e.js";import{C as y}from"./index-e693154d.js";import{C as N}from"./index-d93151a5.js";import{D as g}from"./index-d88d2b2a.js";import"./index-57f63cdf.js";import{F as C}from"./index-85dc0d3a.js";import{I as k}from"./index-a1eba122.js";import{a as S}from"./index-801a9590.js";import"./index-d90fa46f.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{s as w}from"./store-77f5b287.js";import{M as Y}from"./index-6226197c.js";import"./index-4a60c0a0.js";import"./CalendarOutlined-8ff6678f.js";import"./responsiveObserve-cfbf1a72.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";var I=e.forwardRef((function(o,r){var d,c=o.prefixCls,u=void 0===c?"rc-switch":c,m=o.className,p=o.checked,x=o.defaultChecked,h=o.disabled,v=o.loadingIcon,j=o.checkedChildren,b=o.unCheckedChildren,f=o.onClick,y=o.onChange,N=o.onKeyDown,g=a(o,["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"]),C=s(!1,{value:p,defaultValue:x}),k=t(C,2),S=k[0],w=k[1];function Y(e,a){var s=S;return h||(w(s=e),null==y||y(s,a)),s}var I=l(u,m,(i(d={},"".concat(u,"-checked"),S),i(d,"".concat(u,"-disabled"),h),d));return e.createElement("button",Object.assign({},g,{type:"button",role:"switch","aria-checked":S,disabled:h,className:I,ref:r,onKeyDown:function(e){e.which===n.LEFT?Y(!1,e):e.which===n.RIGHT&&Y(!0,e),null==N||N(e)},onClick:function(e){var a=Y(!S,e);null==f||f(a,e)}}),v,e.createElement("span",{className:"".concat(u,"-inner")},S?j:b))}));I.displayName="Switch";var D=globalThis&&globalThis.__rest||function(e,a){var s={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(s[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(t=Object.getOwnPropertySymbols(e);l<t.length;l++)a.indexOf(t[l])<0&&Object.prototype.propertyIsEnumerable.call(e,t[l])&&(s[t[l]]=e[t[l]])}return s},F=e.forwardRef((function(a,s){var t=a.prefixCls,n=a.size,p=a.disabled,x=a.loading,h=a.className,v=void 0===h?"":h,j=D(a,["prefixCls","size","disabled","loading","className"]),b=e.useContext(o),f=b.getPrefixCls,y=b.direction,N=e.useContext(r),g=e.useContext(d),C=(null!=p?p:g)||x,k=f("switch",t),S=e.createElement("div",{className:"".concat(k,"-handle")},x&&e.createElement(m,{className:"".concat(k,"-loading-icon")})),w=l(i(i(i({},"".concat(k,"-small"),"small"===(n||N)),"".concat(k,"-loading"),x),"".concat(k,"-rtl"),"rtl"===y),v);return e.createElement(c,{insertExtraNode:!0},e.createElement(I,u({},j,{prefixCls:k,className:w,disabled:C,ref:s,loadingIcon:S})))}));F.__ANT_SWITCH=!0;const M=F;function O(){var a,s,t,l,i,n;const{t:o}=p();document.title="HADO CRM";let[r,d]=x();const c=r.get("license"),u={labelCol:{span:10},wrapperCol:{span:16}},[m]=C.useForm(),[I]=C.useForm(),[D,F]=e.useState(),O=async()=>{var e,a,s;const t=await w.getLicenseDetail({uuid:c});if(t&&200===t.code){F(t.data);const l=t.data.version.map((e=>({key:e.puuid,...e})));if(z(l),J(l.map((e=>e.prodname)).join(",")),W(l.map((e=>e.puuid))),null==(e=null==D?void 0:D.codetoprovider)?void 0:e.expiredate){const e=j(null==(s=null==(a=t.data)?void 0:a.codetoprovider)?void 0:s.expiredate,"YYYY-MM-DD");Z(e)}}else f.error((null==t?void 0:t.msg)??o("dataFetchFailed"))},[V,T]=e.useState([]),[E,_]=e.useState(),[P,L]=e.useState(),[A,U]=e.useState(),[R,z]=e.useState([]),[B,W]=e.useState([]),[H,K]=e.useState(0),[q,G]=e.useState(!1),[Q,Z]=e.useState(),[$,J]=e.useState(""),[X,ee]=e.useState(!0),[ae,se]=e.useState(!1),[te,le]=e.useState([]),[ie,ne]=e.useState([]),oe=async()=>{const e=await w.getProduct();if(e&&200===e.code){const a=e.data.map((e=>({key:e.uuid,...e})));ne(a)}else f.error(e.msg||"产品列表获取失败")},re=[{title:o("productName"),dataIndex:"prodname",key:"prodname"},{title:o("currentVersion"),dataIndex:"version",key:"version"},{title:o("latestVersion"),dataIndex:"versioncode",key:"versioncode"},{title:o("status"),dataIndex:"status_main",key:"status_main"},{title:o("statusDescription"),dataIndex:"status_details",key:"status_details"},{title:o("action"),dataIndex:"action",key:"action",render:(e,a)=>h.jsx(v,{type:"primary",style:{marginLeft:"20px"},onClick:()=>pe(a),children:o("changes")})}],[de,ce]=e.useState(!1),[ue,me]=e.useState(),pe=e=>{ce(!0),me(e),I.setFieldsValue({status:e.status}),L(e.status),0===e.status&&U(j(null==e?void 0:e.validationdate,"YYYY-MM-DD"))},xe=[{label:o("buyout"),value:1},{label:o("monthly"),value:0},{label:o("freezeBy"),value:2}];e.useEffect((()=>{(async()=>{const e=await w.getCharge();if(e&&200===e.code){const a=e.data.map((e=>({label:e.name,value:e.id})));T(a)}else f.error((null==e?void 0:e.msg)??o("dataFetchFailed"))})(),O(),oe()}),[]);const he={emptyText:o("noDataAvailable")};return h.jsxs("div",{className:"license-box",children:[h.jsx(y,{title:o("basicInformationofSerialNumber"),bordered:!0,children:h.jsxs("div",{className:"store-info-box",children:[h.jsxs("div",{className:"info-box-line",children:[h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("distributor"),"："]}),h.jsx("span",{children:null==D?void 0:D.agentinname})]}),h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("storeName"),"："]}),h.jsx("span",{children:null==D?void 0:D.providername})]})]}),h.jsxs("div",{className:"info-box-line",children:[h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("courtName"),"："]}),h.jsx("span",{children:null==D?void 0:D.stationname})]}),h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("serialNumber"),"："]}),h.jsx("span",{children:null==(a=null==D?void 0:D.codetoprovider)?void 0:a.regcode})]})]}),h.jsxs("div",{className:"info-box-line",children:[h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("activationStatus"),"："]}),h.jsx("span",{children:1===(null==D?void 0:D.status)?o("activate"):o("freeze")}),h.jsx(v,{type:"primary",style:{marginLeft:"20px"},onClick:()=>{var e,a,s;G(!0),m.setFieldValue("method",null==(e=null==D?void 0:D.codetoprovider)?void 0:e.regproperty),_(null==(a=null==D?void 0:D.codetoprovider)?void 0:a.regproperty);const t=1===(null==D?void 0:D.status);ee(t),m.setFieldValue("status",t),Z(j(null==(s=null==D?void 0:D.codetoprovider)?void 0:s.expiredate,"YYYY-MM-DD"))},children:o("changes")})]}),h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("statusDescription"),"："]}),h.jsx("span",{children:null==(t=null==(s=null==D?void 0:D.codetoprovider)?void 0:s.statusreamk)?void 0:t.split(" ")[0]})]})]}),h.jsxs("div",{className:"info-box-line",children:[h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("productContent"),"："]}),h.jsx("span",{children:$||"未添加"}),h.jsx(v,{type:"primary",style:{marginLeft:"20px"},onClick:()=>{const e=null==D?void 0:D.version,a=null==e?void 0:e.map((e=>e.puuid));le(a),se(!0)},children:o("changes")})]}),h.jsxs("div",{className:"line-item",children:[h.jsxs("span",{className:"line-label",children:[o("usageLimitations"),"："]}),h.jsx("span",{children:o("hostRestrictions")})]})]})]})}),h.jsx(S,{className:"productBox",dataSource:R,columns:re,locale:he,pagination:{position:[]}},"puuid"),h.jsx(Y,{title:o("activate"),open:q,onOk:async()=>{const e=await m.validateFields();let a="";try{a=j(null==e?void 0:e.time).format("YYYY-MM-DD")}catch(l){}const s={reguuid:null==D?void 0:D.reguuid,regproperty:null==e?void 0:e.method,status:!0===(null==e?void 0:e.status)?1:2,expiredate:a,volnum:H},t=await w.updateLicense(s);t&&200===t.code?(f.success("success"),G(!1),O()):f.error((null==t?void 0:t.msg)??"error")},onCancel:()=>{m.resetFields(),G(!1)},cancelText:o("cancel"),okText:o("confirm"),children:h.jsx("div",{className:"active-box",children:h.jsxs(C,{...u,form:m,name:"control-hooks",style:{maxWidth:600},children:[h.jsx(C.Item,{name:"method",label:o("billingMethod"),children:h.jsx(b,{placeholder:o("pleaseEnter"),onChange:e=>{_(e),0!==e&&3!==e||Z(j())},options:V,style:{width:"200px"},allowClear:!0})}),1===E?h.jsxs("div",{children:[h.jsx(C.Item,{name:"time",label:"充值次数",children:h.jsx(k,{style:{width:"200px"},addonAfter:"次",onChange:e=>{K(e)}})}),h.jsx(C.Item,{name:"time",label:"使用期限",children:h.jsxs("span",{children:["剩余",parseInt((null==(l=null==D?void 0:D.codetoprovider)?void 0:l.volumne.toString())||"0")+H,"次"]})})]}):2===E?h.jsx(C.Item,{name:"time",label:o("serialNumberValidUntil"),children:h.jsx("span",{children:o("serialNumberValidForever")})}):h.jsx(C.Item,{name:"time",label:o("serialNumberValidUntil"),initialValue:Q,children:h.jsx(g,{placeholder:o("pleaseSelect"),format:"YYYY-MM-DD",value:Q})}),h.jsx(C.Item,{name:"status",label:o("serviceStatus"),valuePropName:"checked",children:h.jsx(M,{checkedChildren:o("run"),unCheckedChildren:o("close"),checked:X,onChange:e=>{m.setFieldValue("status",e)}})})]})})},"license"),h.jsx(Y,{title:o("productContent"),open:ae,onOk:async()=>{const e=te.join(","),a=await w.updateProduct({stationuuid:D.stationuuid,puuids:e});a&&200===a.code?(f.success("success"),O(),se(!1)):f.error((null==a?void 0:a.msg)??"error")},onCancel:()=>{se(!1)},cancelText:o("cancel"),okText:o("confirm"),children:h.jsx("div",{className:"product-box",children:h.jsx(N.Group,{style:{width:"100%"},onChange:e=>{le(e)},defaultValue:B,children:ie.map((e=>h.jsx(N,{value:e.uuid,disabled:"HADO Server"===e.prodname,children:e.prodname},e.uuid)))})})},"product"),h.jsx(Y,{title:"产品激活",open:de,onOk:async()=>{const e=await I.validateFields();let a="";e.validationdate&&0===e.status&&(a=j(null==e?void 0:e.validationdate).format("YYYY-MM-DD"));const s={stationuuid:D.stationuuid,puuid:ue.puuid,status:e.status,validationdate:a};200===(await w.updateProductStatus(s)).code?f.success("success"):f.error("error"),ce(!1),O(),oe()},onCancel:()=>{ce(!1)},cancelText:o("cancel"),okText:o("confirm"),children:h.jsx("div",{className:"active-box",children:h.jsxs(C,{...u,form:I,name:"control-hooks",style:{maxWidth:600},children:[h.jsx("div",{className:"licenseCenter",children:h.jsx("span",{children:null==(n=null==(i=null==D?void 0:D.codetoprovider)?void 0:i.statusreamk)?void 0:n.split(" ")[0]})}),h.jsx(C.Item,{name:"status",label:o("activationMethod"),children:h.jsx(b,{placeholder:o("pleaseSelect"),onChange:e=>{L(e)},options:xe,style:{width:"200px"},allowClear:!0})}),0===P?h.jsx(C.Item,{name:"validationdate",label:o("serialNumberValidUntil"),children:h.jsx(g,{placeholder:o("pleaseSelect"),format:"YYYY-MM-DD",defaultValue:A,value:A})}):1===P?h.jsx(C.Item,{name:"time",label:o("serialNumberValidUntil"),children:h.jsx("span",{children:o("serialNumberValidForever")})}):h.jsx(C.Item,{name:"time",label:o("serialNumberValidUntil"),children:h.jsx("span",{children:"-"})})]})})},"productActive")]})}export{O as default};

import{b as e,u as t,e as s,r as a,j as i,T as r,S as l,B as o,m as n,h as d}from"./index-aeca932e.js";import{F as m}from"./index-85dc0d3a.js";import{I as c}from"./index-d90fa46f.js";import{a as p}from"./index-801a9590.js";import"./index-d93151a5.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{P as u}from"./index-60197fbb.js";import{D as x}from"./index-a0588428.js";import{I as j}from"./index-a1eba122.js";import{D as h}from"./index-d88d2b2a.js";import{T as y}from"./index-57f63cdf.js";import{u as v}from"./user-a3dc1d16.js";import{s as g}from"./store-77f5b287.js";import{u as f}from"./useSetState-8e08c7f5.js";import{D as S}from"./DisconnectOutlined-764e4556.js";import{C as b}from"./CheckOutlined-ab04c92f.js";import{S as T}from"./SearchOutlined-fa850377.js";import{M as w}from"./index-6226197c.js";import{E as N}from"./EyeOutlined-d33bc3ff.js";import{E as C}from"./EditOutlined-21831c3e.js";import{P as k}from"./PlusCircleOutlined-90803570.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-4a60c0a0.js";import"./ActionButton-04036752.js";import"./CalendarOutlined-8ff6678f.js";import"./Portal-0dc81ff6.js";const{TextArea:I}=c,z={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},{RangePicker:D}=h;function O(){const{t:h}=e();document.title="HADO CRM";const O=t(),P=s((e=>e.app.powersCode));s((e=>e.sys.powerTreeData));const[E]=m.useForm(),[Y,q]=a.useState([]),[L,M]=a.useState(!1),[F,A]=f({pageNum:1,pageSize:10,total:0}),[R,$]=f({operateType:"add",nowData:null,modalShow:!1,modalLoading:!1}),[B,V]=f({title:void 0,storeType:void 0,storeState:1,storeProxy:void 0,startTime:void 0,endTime:void 0});f({treeOnOkLoading:!1,powerTreeShow:!1,powerTreeDefault:{menus:[],powers:[]}});const Q=async e=>{if(!P.includes("store:query"))return;const t={page:e.pageNum,limit:e.pageSize,providername:B.title,providerlevel:B.storeType,provideragentuuid:B.storeProxy,status:B.storeState,starttime:B.startTime,endtime:B.endTime};M(!0);try{const s=await g.getStoreList(t);s&&200===s.code?(q(s.data),A({total:s.cont,pageNum:e.pageNum,pageSize:e.pageSize})):n.error((null==s?void 0:s.message)??h("dataFetchFailed"))}finally{M(!1)}},U=(e,t)=>{O("add"===t?"/store/add?store=add":"up"===t?`/store/edit?store=${null==e?void 0:e.uuid}`:`/store/detail?store=${null==e?void 0:e.uuid}`)},[_,H]=a.useState([]),J=[{label:h("all"),value:""},{label:h("activate"),value:1},{label:h("freeze"),value:2}],[W,X]=a.useState([]),[Z,G]=a.useState([]),K=[{title:h("storeName"),dataIndex:"title",key:"title"},{title:h("storeType"),dataIndex:"storeType",key:"storeType"},{title:h("storeStatus"),dataIndex:"storeState",key:"storeState"},{title:h("distributor"),dataIndex:"proxy",key:"proxy"},{title:h("creationTime"),dataIndex:"createTime",key:"createTime"},{title:h("courtNumber"),dataIndex:"playId",key:"playId",render:(e,t)=>t.playId.map((e=>i.jsx(y,{color:"green",children:e.stationname},e.uuid)))},{title:h("action"),key:"control",width:200,render:(e,t)=>{const s=[];P.includes("store:see")&&s.push(i.jsx("span",{className:"control-btn blue",onClick:()=>U(t,"see"),children:i.jsx(r,{placement:"top",title:h("view"),children:i.jsx(N,{})})},"1")),P.includes("store:edit")&&s.push(i.jsx("span",{className:"control-btn blue",onClick:()=>U(t,"up"),children:i.jsx(r,{placement:"top",title:h("edit"),children:i.jsx(C,{})})},"2")),P.includes("store:freeze")&&s.push(i.jsx(u,{title:1===t.status?h("freeze"):h("enable"),onConfirm:()=>(async e=>{M(!0);try{let t=await g.freezeStore({uuid:e.uuid,status:1===e.status?2:1});t&&200===t.code?(n.success("success"),Q(F)):n.error((null==t?void 0:t.message)??"error")}finally{M(!1)}})(t),okText:h("confirm"),cancelText:h("cancel"),children:i.jsx("span",{className:"control-btn red",children:i.jsx(r,{placement:"top",title:1===t.status?h("freeze"):h("enable"),children:1===t.status?i.jsx(S,{}):i.jsx(b,{style:{color:"green"}})})})},"3"));const a=[];return s.forEach(((e,t)=>{t&&a.push(i.jsx(x,{type:"vertical"},`line${t}`)),a.push(e)})),a}}],ee=a.useMemo((()=>null==Y?void 0:Y.map(((e,t)=>{var s,a,i,r,l;return{key:e.id,uuid:e.uuid,serial:t+1+(F.pageNum-1)*F.pageSize,title:e.providername,storeType:e.providerlevel_name,storeId:e.uuid,storeState:1===e.status?h("activate"):h("freeze"),proxy:e.agentinfor?null==(s=e.agentinfor)?void 0:s.providername:"-",proxyId:e.agentinfor?e.agentinfor.uuid:"-",createTime:e.addtime,playId:(null==(a=null==e?void 0:e.statuibe)?void 0:a.length)?null==e?void 0:e.statuibe:[],status:e.status,licenseStatus:(null==(i=null==e?void 0:e.statuibe)?void 0:i.length)>0?null==(l=null==(r=null==e?void 0:e.statuibe.codetoprovider)?void 0:r.codestruct)?void 0:l.statusreamk:"-"}}))),[F,Y]),te={emptyText:h("noDataAvailable")};return a.useEffect((()=>{Q(F),(async()=>{const e=(await g.getStoreType()).data.map((e=>({label:e.name,value:e.id})));H(e)})(),(async()=>{const e=(await v.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));X(e)})()}),[]),i.jsxs("div",{className:"store-list-box",children:[i.jsxs("div",{className:"g-search",children:[P.includes("store:query")?i.jsxs("ul",{className:"search-ul",children:[i.jsxs("li",{className:"search-item",children:[i.jsxs("span",{className:"item-lable",children:[h("storeName"),":"]}),i.jsx(c,{placeholder:h("pleaseEnter"),onChange:e=>{e.target.value.length<20&&V({title:e.target.value})},value:B.title,style:{width:"140px"}})]}),i.jsxs("li",{className:"search-item",children:[i.jsxs("span",{className:"item-lable",children:[h("storeType"),":"]}),i.jsx(l,{placeholder:h("pleaseSelect"),allowClear:!0,style:{width:"110px"},onChange:async e=>{V({storeType:e})},value:B.storeType,options:_})]}),i.jsxs("li",{className:"search-item",children:[i.jsxs("span",{className:"item-lable",children:[" ",h("storeStatus"),":"]}),i.jsx(l,{placeholder:h("pleaseSelect"),allowClear:!0,style:{width:"110px"},onChange:async e=>{const t=J.find((t=>t.value===e));V({storeState:t.value})},value:B.storeState,options:J})]}),i.jsxs("li",{className:"search-item",children:[i.jsxs("span",{className:"item-lable",children:[h("distributor"),":"]}),i.jsx(l,{placeholder:h("pleaseSelect"),allowClear:!0,style:{width:"110px"},onChange:e=>{V({storeProxy:e})},value:B.storeProxy,options:W})]}),i.jsxs("li",{className:"search-item",style:{marginLeft:"20px"},children:[i.jsxs("span",{className:"item-lable",children:[h("creationTime"),":"]}),i.jsx(D,{style:{width:"220px"},onChange:e=>{V(e?{startTime:d(e[0]).format("YYYY-MM-DD"),endTime:d(e[1]).format("YYYY-MM-DD")}:{startTime:void 0,endTime:void 0})},placeholder:[h("startDate"),h("endDate")]})]}),i.jsx("li",{style:{marginLeft:"20px"},children:i.jsx(o,{type:"primary",icon:i.jsx(T,{}),onClick:()=>{Q(F)},children:h("search")})})]}):i.jsx("div",{}),i.jsx("ul",{className:"search-func",children:P.includes("store:add")&&i.jsx("li",{children:i.jsx(o,{type:"primary",icon:i.jsx(k,{}),disabled:!P.includes("store:add"),onClick:()=>U(null,"add"),children:h("addNew")})})})]}),i.jsx("div",{className:"diy-table",children:i.jsx(p,{columns:K,loading:L,locale:te,dataSource:ee,pagination:{total:F.total,current:F.pageNum,pageSize:F.pageSize,showQuickJumper:!1,showTotal:e=>h("dataNumber",{count:e}),onChange:(e,t)=>((e,t)=>{Q({pageNum:e,pageSize:t||F.pageSize})})(e,t)}})}),i.jsx(w,{title:{add:h("addNew"),up:h("edit"),see:h("view")}[R.operateType],open:R.modalShow,cancelText:h("cancel"),okText:h("confirm"),onCancel:()=>(E.setFieldsValue({rolename:"",proxy:"",store:"",desc:"",limit:""}),void $({modalShow:!1})),confirmLoading:R.modalLoading,children:i.jsxs(m,{form:E,initialValues:{formConditions:1},children:[i.jsx(m.Item,{label:"角色名称",name:"rolename",...z,rules:[{required:!0,whitespace:!0,message:"请输入角色名称"},{max:20,message:"最多输入20位字符"}],children:i.jsx(c,{placeholder:"请输入角色名",disabled:"see"===R.operateType})}),i.jsx(m.Item,{label:"所属代理",name:"proxy",...z,rules:[{required:!0,message:"请选择所属代理"}],children:i.jsx(l,{disabled:"see"===R.operateType,options:W,onSelect:async e=>{var t;const s=null==(t=(await v.getStores({agenuuid:e})).data)?void 0:t.map((e=>({label:e.providername,value:e.uuid})));G(s)},placeholder:"请选择所属代理"})}),i.jsx(m.Item,{label:"所属门店",name:"store",...z,rules:[{required:!0,message:"请选择所属门店"}],children:i.jsx(l,{disabled:"see"===R.operateType,options:Z,placeholder:"请选择所属门店"})}),i.jsx(m.Item,{label:"角色描述",name:"desc",...z,rules:[{max:200,message:"最多输入200个字符"},{required:!0,message:"请输入角色描述"}],children:i.jsx(I,{rows:4,disabled:"see"===R.operateType,autoSize:{minRows:2,maxRows:6}})}),i.jsx(m.Item,{label:"数量限制",name:"limit",...z,rules:[{required:!0,message:"请输入数量限制"}],children:i.jsx(j,{min:0,max:99,style:{width:"100%"},disabled:"see"===R.operateType})})]})})]})}export{O as default};

import{b as e,g as s,u as i,r as l,j as a,S as t,t as n,B as o,h as r,k as d,m}from"./index-aeca932e.js";import{C as u}from"./index-e693154d.js";import{T as c}from"./index-376edbd3.js";import"./index-d88d2b2a.js";import"./index-57f63cdf.js";/* empty css              */import{F as p}from"./index-85dc0d3a.js";import{I as v}from"./index-d90fa46f.js";import{u as h}from"./user-a3dc1d16.js";import{s as j}from"./store-77f5b287.js";import{I as x}from"./antd-img-crop.esm-86a10eb1.js";import{U as f}from"./index-af455608.js";import{U as y}from"./UploadOutlined-636e8664.js";import"./CalendarOutlined-8ff6678f.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./index-6226197c.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";import"./getScrollBarSize-6b2349d8.js";import"./index-5bcf51a7.js";import"./useForceUpdate-c2b76191.js";import"./DeleteOutlined-6b999003.js";function b(){const{t:b}=e(),[g]=p.useForm(),[N]=p.useForm();let[S,C]=s();const I=S.get("store"),F=localStorage.getItem("token"),w=i();document.title="HADO CRM";const[E,P]=l.useState([]),[T,D]=l.useState({label:"",value:""}),[A,H]=l.useState({label:"",value:0}),[O,k]=l.useState([]),[_,q]=l.useState(0),[B,$]=l.useState(),[L,W]=l.useState([]),[U,z]=l.useState(),[V,M]=l.useState([]),R=async e=>{const s=(await j.getCountry({continentid:e})).data.map((e=>({label:e.nationname,value:e.id})));M(s)},G=e=>{},Q=e=>{},[Y,Z]=l.useState([]),J={accept:"image/*",headers:{Authorization:`${F}`},action:`${d}service_api/file_upload`,onChange({file:e,fileList:s}){e.status,Z(s)},fileList:Y,maxCount:5,multiple:!0},[K,X]=l.useState([]),ee={accept:"image/*",headers:{Authorization:`${F}`},action:`${d}service_api/file_upload`,onChange({file:e,fileList:s}){e.status,X(s)},fileList:K,maxCount:1};return l.useEffect((()=>{(async()=>{const e=(await h.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));P(e)})(),(async()=>{const e=(await j.getStoreType()).data.map((e=>({label:e.name,value:e.id})));k(e)})(),(async()=>{const e=(await j.getArea()).data.map((e=>({label:e.name,value:e.id})));W(e)})(),"add"!==I&&(async()=>{var e,s,i,l,a,t,n,o,d,m,u,c,p,v,h,x,f,y,b,S,C;const F=(await j.getStoreDetail({uuid:I})).data,w=null==(i=null==(s=null==(e=null==F?void 0:F.detileinfor)?void 0:e.comments)?void 0:s.businesstime)?void 0:i.split("-"),E=null==w?void 0:w.map((e=>r(e,"HH:mm"))),P={storename:null==F?void 0:F.providername,company:null==(a=null==(l=null==F?void 0:F.detileinfor)?void 0:l.comments)?void 0:a.companyname,proxyname:null==(t=null==F?void 0:F.agentinfor)?void 0:t.providername,storetype:null==F?void 0:F.providerlevel_name,storepath:"1",pathDetail:null==(o=null==(n=null==F?void 0:F.detileinfor)?void 0:n.comments)?void 0:o.providaddr,pathDesc:null==(m=null==(d=null==F?void 0:F.detileinfor)?void 0:d.comments)?void 0:m.addrremark,storePhone:null==F?void 0:F.mob,storeTime:E},T={label:null==F?void 0:F.providerlevel_name,value:null==F?void 0:F.provideragentuuid};D(T);const A={label:null==F?void 0:F.providerlevel_name,value:null==F?void 0:F.providerlevel};H(A);const O=null==F?void 0:F.continentid;$(O);const k=null==F?void 0:F.nationid;z(k);const _={personName:null==(u=null==F?void 0:F.providercontact)?void 0:u.username,personPhone:null==(c=null==F?void 0:F.providercontact)?void 0:c.usermob,personEmail:null==(p=null==F?void 0:F.providercontact)?void 0:p.email},q=null==(f=null==(x=null==(h=null==(v=null==F?void 0:F.detileinfor)?void 0:v.providerpic)?void 0:h.providerimg)?void 0:x.split(","))?void 0:f.map(((e,s)=>({name:`file${s+1}`,url:e})));Z(q);const B=null==(C=null==(S=null==(b=null==(y=null==F?void 0:F.detileinfor)?void 0:y.providerpic)?void 0:b.providerlogo)?void 0:S.split(","))?void 0:C.map(((e,s)=>({name:`logo${s+1}`,url:e})));X(B),g.setFieldsValue(P),N.setFieldsValue(_)})()}),[]),a.jsxs("div",{className:"store-edit",children:[a.jsx("div",{className:"item",children:a.jsx(u,{title:b("storeInformation"),bordered:!0,children:a.jsxs(p,{form:g,name:"storeInfo",wrapperCol:{span:16},onFinish:G,labelAlign:"left",onFinishFailed:Q,autoComplete:"off",children:[a.jsxs("div",{className:"first",children:[a.jsx(p.Item,{label:b("storeName"),name:"storename",rules:[{required:!0,message:b("storeNameCannotBeEmpty")}],children:a.jsx(v,{})}),a.jsx(p.Item,{label:b("companyName"),name:"company",rules:[{message:b("pleaseEnter")}],children:a.jsx(v,{})})]}),a.jsxs("div",{className:"first",children:[a.jsx(p.Item,{label:b("storeType"),name:"storetype",rules:[{required:!0,message:b("storeTypeCannotBeEmpty")}],children:a.jsx(t,{options:O,value:A,onSelect:async e=>{const s=O.find((s=>s.value===e));H(s),q(e)}})}),5!==_&&a.jsx(p.Item,{label:b("distributor"),name:"proxyname",rules:[{required:!0,message:b("agentCannotBeEmpty")}],children:a.jsx(t,{options:E,value:T,onSelect:async e=>{const s=E.find((s=>s.value===e));D(s)}})})]}),a.jsx("div",{className:"first path",children:a.jsx(p.Item,{label:b("storeAddress"),name:"storepath",rules:[{required:!0,message:b("storeAddressCannotBeEmpty")}],children:a.jsxs("div",{className:"path-city-field",children:[a.jsx(t,{options:L,value:B,onSelect:async e=>{z(null);const s=L.find((s=>s.value==e));$(s.value),R(e)}}),a.jsx(t,{options:V,value:U,onSelect:async e=>{const s=V.find((s=>s.value===e));z(s.value),g.setFieldValue("storepath",e),g.setFields([{name:"storepath",errors:null}])}})]})})}),a.jsx(p.Item,{label:b("detailedAddress"),name:"pathDetail",style:{maxWidth:1e3},rules:[{message:"请输入详细地址"}],children:a.jsx(v,{})}),a.jsx(p.Item,{label:b("addressDescription"),name:"pathDesc",style:{maxWidth:1e3},rules:[{message:"请输入地址描述"}],children:a.jsx(v,{})}),a.jsxs("div",{className:"first",children:[a.jsx(p.Item,{label:b("storePhoneNumber"),name:"storePhone",style:{maxWidth:1e3},children:a.jsx(v,{})}),a.jsx(p.Item,{label:b("businessHours"),name:"storeTime",style:{maxWidth:1e3},rules:[{type:"array",message:"请选择营业时间!"}],children:a.jsx(c.RangePicker,{format:"HH:mm",placeholder:[b("startDate"),b("endDate")]})})]})]})})}),a.jsx("div",{className:"item",children:a.jsx(u,{title:b("storeManagerInformation"),bordered:!0,children:a.jsxs(p,{name:"storePerson",form:N,wrapperCol:{span:16},onFinish:G,labelAlign:"right",onFinishFailed:Q,autoComplete:"off",children:[a.jsxs("div",{className:"first",children:[a.jsx(p.Item,{label:b("name"),name:"personName",rules:[{required:!0,message:b("pleaseEnter")}],children:a.jsx(v,{style:{width:270}})}),a.jsx(p.Item,{label:b("phoneNumber"),name:"personPhone",labelCol:{span:7},children:a.jsx(v,{style:{width:270}})})]}),a.jsx("div",{className:"first",children:a.jsx(p.Item,{label:b("email"),name:"personEmail",labelCol:{span:2.5},style:{maxWidth:1e3},rules:[()=>({validator:(e,s)=>{const i=s;return i&&!n.checkEmail(i)?Promise.reject(b("incorrectEmailFormat")):Promise.resolve()}}),{required:!0,message:b("pleaseEnter")}],children:a.jsx(v,{style:{width:270}})})})]})})}),a.jsx("div",{className:"item",children:a.jsxs(u,{title:b("otherInformation"),bordered:!0,children:[a.jsxs("div",{className:"inline",children:[a.jsxs("span",{className:"inline-label",children:[b("storePhotos"),"："]}),a.jsx("div",{className:"file-upload",children:a.jsx(f,{...J,listType:"picture",children:a.jsx(o,{icon:a.jsx(y,{}),children:b("uploadFile")})})}),a.jsx("div",{className:"tips",children:b("tips2",{num:10,count:5})})]}),a.jsxs("div",{className:"inline",children:[a.jsxs("span",{className:"inline-label",children:[b("storeLOGO"),"："]}),a.jsx("div",{className:"file-upload",children:a.jsx(x,{children:a.jsx(f,{...ee,listType:"picture",children:a.jsx(o,{icon:a.jsx(y,{}),children:b("uploadFile")})})})}),a.jsxs("div",{className:"tips",children:[b("storeInformation"),b("tips2",{num:10,count:1})]})]})]})}),a.jsxs("div",{className:"submit-btn",children:[a.jsx(o,{type:"primary",onClick:async()=>{try{const e=await g.validateFields(),s=await N.validateFields();let i,l={providername:e.storename,provideragentuuid:T.value,providerlevel:A.value,providaddr:e.pathDetail,mob:s.personPhone,username:s.personName,usermob:s.personPhone,email:s.personEmail,continentid:B,nationid:U,addrremark:e.pathDesc,businesstime:e.storeTime?r(e.storeTime[0]).format("HH:mm")+"-"+r(e.storeTime[1]).format("HH:mm"):"",companyname:e.company,providerimg:null==Y?void 0:Y.map((e=>{var s;return e.response?null==(s=null==e?void 0:e.response)?void 0:s.data:e.url})).join(","),providerlogo:null==K?void 0:K.map((e=>{var s;return e.response?null==(s=null==e?void 0:e.response)?void 0:s.data:e.url})).join(",")};"add"===I?i=await j.saveStore(l):(l.uuid=I,i=await j.updateStore(l)),i&&200===i.code?(m.success("success"),w("/store/list")):m.error((null==i?void 0:i.message)??"error")}catch(e){}},children:b("submit")}),a.jsx(o,{htmlType:"button",onClick:()=>{w(-1)},style:{marginLeft:80},children:b("return")})]})]})}export{b as default};

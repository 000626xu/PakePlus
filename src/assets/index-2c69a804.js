import{b as e,g as i,u as l,r as a,j as s,S as t,n,B as o,h as r,m}from"./index-aeca932e.js";import{C as d}from"./index-e693154d.js";import{C as u}from"./index-d93151a5.js";import{F as c}from"./index-85dc0d3a.js";import{I as p}from"./index-d90fa46f.js";import{I as x}from"./index-a1eba122.js";import{T as j}from"./index-376edbd3.js";import"./index-d88d2b2a.js";import"./index-57f63cdf.js";import{u as v}from"./user-a3dc1d16.js";import{s as f}from"./store-77f5b287.js";import{C as h}from"./CloseOutlined-4f0ea934.js";import"./index-4a60c0a0.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./CalendarOutlined-8ff6678f.js";function b(){const{t:b}=e();let[g,y]=i();const C=g.get("field"),H=l();document.title="HADO CRM";const[w]=c.useForm(),[I,S]=a.useState([]),[T,N]=a.useState([]),k=async e=>{const i=(await v.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));N(i)},F=[{label:"周一",value:"mon"},{label:"周二",value:"tue"},{label:"周三",value:"wed"},{label:"周四",value:"thu"},{label:"周五",value:"fri"},{label:"周六",value:"sat"},{label:"周日",value:"sun"}],O=()=>{};a.useEffect((()=>{(async()=>{const e=(await v.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));S(e)})(),(async()=>{var e,i,l,a,s,t,n,o;const d=await f.fileDetail({uuid:C});if(d&&200===d.code){const m=null==d?void 0:d.data,u=(null==(e=null==m?void 0:m.stationintro)?void 0:e.start_time)?r(null==(i=null==m?void 0:m.stationintro)?void 0:i.start_time,"HH:mm"):"",c=(null==(l=null==m?void 0:m.stationintro)?void 0:l.end_time)?r(null==(a=null==m?void 0:m.stationintro)?void 0:a.end_time,"HH:mm"):"";await k(null==(s=null==m?void 0:m.agentinfor)?void 0:s.uuid);const p={proxy:null==(t=null==m?void 0:m.agentinfor)?void 0:t.uuid,store:null==(n=null==m?void 0:m.provider)?void 0:n.uuid,fileName:null==m?void 0:m.stationname,fileTime:[u,c],limit:null==(o=null==m?void 0:m.stationintro)?void 0:o.maxpeople};w.setFieldsValue(p)}else m.error((null==d?void 0:d.msg)??b("dataFetchFailed"))})()}),[]);return s.jsx("div",{className:"field-edit-box",children:s.jsxs(c,{labelCol:{span:4},wrapperCol:{span:16},form:w,name:"control-hooks",onFinish:e=>{},style:{maxWidth:700},children:[s.jsx(c.Item,{name:"proxy",label:b("distributor"),rules:[{required:!0,message:b("pleaseSelect")}],children:s.jsx(t,{placeholder:b("pleaseSelect"),allowClear:!0,onChange:k,options:I})}),s.jsx(c.Item,{name:"store",label:b("storeName"),rules:[{required:!0,message:b("pleaseSelect")}],children:s.jsx(t,{placeholder:b("pleaseSelect"),onChange:e=>{},options:T,allowClear:!0})}),s.jsx(c.Item,{name:"fileName",label:b("courtName"),rules:[{required:!0,max:12,message:b("pleaseSelect")}],children:s.jsx(p,{})}),s.jsx(c.Item,{name:"fileTime",label:b("businessHours"),children:s.jsx(j.RangePicker,{format:"HH:mm",placeholder:[b("startDate"),b("endDate")]})}),s.jsx(c.Item,{name:"limit",label:b("quantityLimit"),children:s.jsx(x,{min:0,max:99})}),s.jsx(c.List,{name:"items",children:(e=[],{add:i,remove:l})=>s.jsx("div",{style:{display:"flex",rowGap:16,flexDirection:"column",justifyContent:"center"},children:e.map(((e,i)=>s.jsxs(d,{size:"small",title:`价格规则${e.name+1}`,extra:s.jsx(h,{onClick:()=>{l(e.name)}}),children:[s.jsx(c.Item,{label:"整场价格",name:[e.name,"allPrice"],children:s.jsx(p,{})}),s.jsx(c.Item,{label:"散客价格",name:[e.name,"customPrice"],children:s.jsx(p,{})}),s.jsx(c.Item,{label:"价格时间",name:[e.name,"priceTime"],children:s.jsx(j.RangePicker,{format:"HH:mm"})}),s.jsx("div",{className:"week",children:s.jsx(u.Group,{options:F,onChange:O})})]},e.key)))})},1),s.jsxs(n,{className:"bottom-btn",children:[s.jsx(o,{type:"primary",className:"submit",onClick:async()=>{try{const e=await w.validateFields(),i={uuid:C,provideruuid:e.store,stationname:e.fileName,start_time:e.fileTime?r(e.fileTime[0]).format("HH:mm"):"",end_time:e.fileTime?r(e.fileTime[1]).format("HH:mm"):"",maxpeople:e.limit},l=await f.editPlay(i);l&&200===l.code?(m.success("success"),H("/store/field")):m.error((null==l?void 0:l.message)??"error")}catch(e){}},children:b("submit")}),s.jsx(o,{htmlType:"button",onClick:()=>{H(-1)},children:b("return")})]})]})})}export{b as default};

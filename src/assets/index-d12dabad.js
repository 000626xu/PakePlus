import{j as e,r as s,u as a,e as t,S as i,B as r}from"./index-aeca932e.js";import{F as o}from"./index-85dc0d3a.js";import{u as n}from"./user-a3dc1d16.js";import{s as l}from"./server-78efb863.js";import{u as m}from"./useSetState-8e08c7f5.js";import{M as p}from"./index-6226197c.js";import"./responsiveObserve-cfbf1a72.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";import"./getScrollBarSize-6b2349d8.js";const c="/assets/serveDef-b4e536de.jpg";function d(s){const{temp:a,current:t,onClick:i}=s;return e.jsxs("div",{className:t.id===a.id?"serverTemp active":"serverTemp",onClick:()=>{i&&i(s.temp)},children:[e.jsx("img",{src:a.image?a.image:c,alt:"活动图片",className:"tempImg"}),e.jsxs("div",{className:"tempText",children:[e.jsx("span",{className:"title",children:a.name}),e.jsx("span",{className:"time",children:a.time}),e.jsxs("span",{className:"price",children:["¥",a.price]})]})]})}const u=e=>{},x=e=>{};function j(){const[c,j]=s.useState(!1),g=a(),v=t((e=>e.app.agentOpts)),[h,N]=m({proxy:void 0,store:void 0,type:void 0}),[f]=o.useForm(),[y,S]=s.useState([]),[b,C]=m({pageNum:1,pageSize:6,total:0});s.useEffect((()=>{B()}),[b.pageNum]);const B=async()=>{const e=await l.getServeList({page:b.pageNum,limit:b.pageSize,provideruuid:h.proxy,storeuuid:h.store,property:h.type,status:0});if(200===e.code){const s=e.data.map((e=>({id:e.uuid,name:e.prodname,image:e.thumbpic,time:e.showtime,price:e.price})));z(s),C({total:e.cont})}},k=e=>{F(e)},[w,F]=s.useState({uuid:""}),[I,z]=s.useState([]);return e.jsxs("div",{className:"addServe",children:[e.jsxs(o,{name:"basic",form:f,wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},onFinish:u,onFinishFailed:x,autoComplete:"off",children:[e.jsx(o.Item,{label:"所属代理",name:"proxy",rules:[{required:!0,message:"请选择所属代理"}],children:e.jsx(i,{value:h.proxy,onChange:async e=>{N({proxy:e,store:""});const s=(await n.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));S(s)},options:v})}),e.jsx(o.Item,{label:"所属门店",name:"store",rules:[{required:!0,message:"请选择所属门店"}],children:e.jsx(i,{value:h.store,onChange:e=>{N({store:e});y.find((s=>{if(s.value===e)return s}))},options:y})}),e.jsx(o.Item,{label:"服务类型",name:"type",rules:[{required:!0,message:"请选择服务类型"}],children:e.jsx(i,{onChange:e=>{N({type:e})},value:h.type,options:[{value:0,label:"拼场"},{value:2,label:"活动"},{value:3,label:"课程"}]})}),e.jsxs(o.Item,{wrapperCol:{offset:5,span:16},children:[e.jsx(r,{type:"primary",className:"submitBtn",onClick:async()=>{await f.validateFields();B(),j(!0)},children:"一键生成"}),e.jsx(r,{type:"primary",className:"submitBtn",onClick:()=>{const e=v.find((e=>{if(e.value===h.proxy)return e})),s=y.find((e=>{if(e.value===h.store)return e}));localStorage.setItem("creatInfo",JSON.stringify({proxy:e,store:s,type:h.type})),h.proxy&&h.store&&void 0!==h.type&&g("/store/run/server/edit?model=1")},children:"新建"}),e.jsx(r,{className:"submitBtn",onClick:()=>g(-1),children:"返回"})]})]}),e.jsxs(p,{title:"一键生成",open:c,onOk:()=>{w.id&&(j(!1),g(`/store/run/server/edit?model=1&id=${w.id}`))},onCancel:()=>{j(!1)},width:600,children:[e.jsx("div",{className:"tempBox",children:I.map((s=>e.jsx(d,{temp:s,current:w,onClick:k},s.id)))}),e.jsxs("div",{className:"tempFooter",children:[e.jsx(r,{className:"preBtn",onClick:()=>{b.pageNum>1&&C({pageNum:b.pageNum-1})},children:"上一页"}),e.jsxs("div",{className:"pageBox",children:[e.jsx("span",{className:"curPage",children:b.pageNum}),"/",Math.ceil(b.total/b.pageSize)]}),e.jsx(r,{className:"nextBtn",onClick:()=>{b.pageNum<Math.ceil(b.total/b.pageSize)&&C({pageNum:b.pageNum+1})},children:"下一页"})]})]})]})}export{j as default};

import{u as e,r,g as s,j as a,m as n,S as i,B as d}from"./index-aeca932e.js";import{F as l}from"./index-85dc0d3a.js";import{I as o}from"./index-d90fa46f.js";import{a as c}from"./index-801a9590.js";import"./index-d93151a5.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{o as m}from"./order-e3583410.js";import{p as u}from"./pay-ddec06ea.js";import{M as p}from"./index-6226197c.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-4a60c0a0.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";function x(){document.title="订单详情";const x=e(),j=()=>{x(-1)};l.useForm();const[h,y]=r.useState({});let[f,g]=s();const v=f.get("order"),b=r.useMemo((()=>h.orderpool?h.orderpool.map(((e,r)=>({type:e.propertyname,name:h.prodname,time:e.showtime,totalPrice:e.price*e.ordernum,ordernum:e.ordernum,price:e.price,sum:e.total}))):[]),[h]),[k,w]=r.useState(!1),[F,C]=r.useState(0),I=e=>{C(e.target.value)},S=async()=>{w(!0);const e=await u.refundAmount({orderuuid:v});e&&200===e.code?C(e.refundmount/100):n.error((null==e?void 0:e.msg)??t("dataFetchFailed"))},[N,T]=r.useState(""),[O,P]=r.useState("原路退款"),R=e=>{P(e)},A=[{title:"支付方式",dataIndex:"payType",key:"payType"},{title:"退款金额",dataIndex:"refund",key:"refund",render:(e,r)=>a.jsxs(a.Fragment,{children:["￥",a.jsx(o,{type:"text",onChange:I,style:{width:60,border:"none",padding:2},value:F})]})},{title:"退款方式",dataIndex:"refundType",key:"refundType",render:()=>a.jsx("div",{children:a.jsx(i,{defaultValue:"原路退款",style:{width:120},bordered:!1,onChange:R,options:[{value:"原路退款",label:"原路退款"}]})})}];r.useEffect((()=>{(async()=>{const e=await m.OrderDetail({orderuuid:v});if(e&&200===e.code){const r=null==e?void 0:e.data;y(r)}else n.error((null==e?void 0:e.msg)??t("dataFetchFailed"))})()}),[]);const B=async e=>{if(1===e)try{const e={orderuuid:v},r=await m.OrderLeave(e);r&&200===r.code?y((e=>({...e,status:2}))):n.error((null==r?void 0:r.message)??"操作失败")}catch(r){}else if(0===e)try{const e={orderuuid:v},r=await m.cancelOrder(e);r&&200===r.code?(n.success("创建成功"),y((e=>({...e,status:3})))):n.error((null==r?void 0:r.message)??"操作失败")}catch(r){}},E=[{value:0,label:"支付宝"},{value:1,label:"微信"},{value:2,label:"现金"},{value:3,label:"银联"},{value:4,label:"其他支付方式"}],M=e=>{const r=E.find((r=>r.value===e));return r?r.label:""},$=r.useMemo((()=>[{payType:M(h?h.paymenttype:"")}]),[h]);return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"order",children:[a.jsx("h1",{children:"订单详情"}),a.jsxs("div",{className:"order-content1",children:[a.jsx("h3",{children:"订单信息"}),a.jsxs("p",{children:[a.jsx("span",{children:"订单状态:"})," ",function(e){switch(e){case 0:return"待付款";case 1:return"已支付";case 2:return"已完成";case 3:return"已取消";case 4:return"已退款";default:return"未知状态"}}(h?h.status:""),h?3===h.status&&a.jsx("span",{style:{color:"red",width:"90px"},children:"(订单未支付)"}):a.jsx(a.Fragment,{})]}),a.jsxs("p",{children:[a.jsx("span",{children:"订单编号:"})," ",v]}),a.jsxs("p",{children:[a.jsx("span",{children:"创建时间:"})," ",h?h.addtime:""]}),a.jsxs("p",{children:[a.jsx("span",{children:"门店:"})," ",h?h.storename:""]}),a.jsxs("p",{children:[a.jsx("span",{children:"支付方式:"})," ",M(h?h.paymenttype:"")]}),a.jsxs("p",{children:[a.jsx("span",{children:"顾客:"})," ",h?h.username:""]}),a.jsxs("p",{children:[a.jsx("span",{style:{width:"85px"},children:"顾客手机号:"})," ",h?h.usermob:""]}),a.jsxs("p",{children:[a.jsx("span",{children:"订单备注:"})," ",h?h.comments:""]})]}),a.jsxs("div",{className:"order-content2",children:[a.jsx("h3",{children:"消费信息"}),a.jsx(c,{dataSource:b,columns:[{title:"类型",dataIndex:"type",key:"type"},{title:"收费项目",dataIndex:"name",key:"name"},{title:"时间",dataIndex:"time",key:"time"},{title:"价格/数量",dataIndex:"totalPrice",key:"totalPrice",render:(e,r)=>` ￥${r.price} × ${r.ordernum}`},{title:"小计",dataIndex:"sum",key:"sum"}],bordered:!0,className:"table",pagination:!1}),a.jsxs("p",{children:[a.jsx("span",{children:"订单合计:"})," ￥",h?h.actualmount:""]}),a.jsx("div",{className:"btn",children:(_=h?h.status:"",0===_?a.jsxs(a.Fragment,{children:[a.jsx(d,{type:"primary",className:"cancel",onClick:()=>{B(_)},children:"取消订单"}),a.jsx(d,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})]}):1===_?a.jsxs(a.Fragment,{children:[a.jsx(d,{type:"primary",onClick:()=>{B(_)},children:"确认核销"}),a.jsx(d,{type:"primary",className:"cancel",onClick:()=>{S()},children:"取消订单"}),a.jsx(d,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})]}):2===_?a.jsxs(a.Fragment,{children:[a.jsx(d,{type:"primary",className:"cancel",onClick:()=>{S()},children:"取消订单"}),a.jsx(d,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})]}):a.jsx(a.Fragment,{children:a.jsx(d,{type:"primary",ghost:!0,onClick:()=>{j()},children:"返回"})}))})]}),a.jsx(p,{title:"退款",open:k,onOk:async()=>{if("原路退款"===O){try{const e={refund_amount:100*F,orderuuid:v,refund_reason:N},r=await u.refund(e);r&&200===r.code?y((e=>({...e,status:4}))):n.error((null==r?void 0:r.message)??"操作失败")}catch(e){}w(!1)}else{try{const e={refundpic:F,orderuuid:v,remarks:N},r=await u.payXRefund(e);r&&200===r.code?y((e=>({...e,status:4}))):n.error((null==r?void 0:r.message)??"操作失败")}catch(e){}w(!1)}},onCancel:()=>{w(!1)},okText:"确认退款",children:a.jsxs(l,{children:[a.jsxs(l.Item,{label:"退款结算",children:[a.jsx(c,{dataSource:$,columns:A,bordered:!0,pagination:!1,className:"tabRefund"}),a.jsxs("p",{style:{margin:0},children:[a.jsx("span",{style:{color:"red"},children:"*"}),"最大退款金额为：",h?h.actualmount:""]})]}),a.jsx(l.Item,{label:"退款说明",children:a.jsx(o.TextArea,{name:"refundReason",rows:3,maxLength:30,placeholder:"可备注退款原因",onChange:e=>{T(e.target.value)}})})]})})]})});var _}export{x as default};

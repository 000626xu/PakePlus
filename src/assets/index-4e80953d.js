import{b as e,u as s,e as a,r as t,m as i,j as l,T as r,S as o,B as n}from"./index-aeca932e.js";import{a as d}from"./index-801a9590.js";import"./index-d93151a5.js";import"./index-d90fa46f.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{D as c}from"./index-a0588428.js";import{u}from"./user-a3dc1d16.js";import{s as p}from"./store-77f5b287.js";import{u as m}from"./useSetState-8e08c7f5.js";import{E as x}from"./EyeOutlined-d33bc3ff.js";import{E as v}from"./EditOutlined-21831c3e.js";import{S as h}from"./SearchOutlined-fa850377.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-4a60c0a0.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./responsiveObserve-cfbf1a72.js";const{Option:j}=o;function y(){const{t:y}=e();document.title="HADO CRM";const g=s(),S=a((e=>e.app.powersCode)),[N,f]=t.useState([]),[b,w]=t.useState(!1),[k,C]=m({pageNum:1,pageSize:10,total:0}),[z,I]=m({proxy:void 0,store:void 0,status:void 0,type:void 0});t.useEffect((()=>{E(k),D(),Q()}),[]);const E=async e=>{const s={page:e.pageNum,limit:e.pageSize,provideragentuuid:z.proxy,provideruuid:z.store,status:z.status,providerlevel:z.type};w(!0);try{const a=await p.getLicense(s);a&&200===a.code?(f(a.data),C({total:a.cont,pageNum:e.pageNum,pageSize:e.pageSize})):i.error((null==a?void 0:a.message)??y("dataFetchFailed"))}finally{w(!1)}},O=(e,s)=>{g("see"===s?`/store/license/detail?license=${e.uuid}`:`/store/license/edit?license=${e.uuid}`)},[T,$]=t.useState([]),D=async()=>{var e;const s=null==(e=(await u.getAgents()).data)?void 0:e.map((e=>({label:e.providername,value:e.uuid})));$(s)},[A,F]=t.useState([]),[B,M]=t.useState([]),Q=async()=>{var e;const s=null==(e=(await p.getStoreType()).data)?void 0:e.map((e=>({label:e.name,value:e.id})));M(s)},R=[{title:y("serialNumber"),dataIndex:"license",key:"license"},{title:y("version"),dataIndex:"product",key:"product",render:(e,s)=>{var a;return l.jsx("span",{children:null==(a=s.product)?void 0:a.map((e=>l.jsx("div",{children:e},e)))})}},{title:y("storeName"),dataIndex:"store",key:"store"},{title:y("distributor"),dataIndex:"proxy",key:"proxy"},{title:y("storeType"),dataIndex:"type",key:"type"},{title:y("courtName"),dataIndex:"field",key:"field"},{title:y("activationStatus"),dataIndex:"status",key:"status",render:(e,s)=>l.jsx("span",{children:1==s.status?y("activate"):y("freeze")})},{title:y("statusDescription"),dataIndex:"express",key:"express"},{title:y("action"),key:"control",render:(e,s)=>{const a=[];S.includes("license:see")&&a.push(l.jsx("span",{className:"control-btn blue",onClick:()=>O(s,"see"),children:l.jsx(r,{placement:"top",title:y("view"),children:l.jsx(x,{})})},"1")),S.includes("license:edit")&&a.push(l.jsx("span",{className:"control-btn blue",onClick:()=>O(s,"up"),children:l.jsx(r,{placement:"top",title:y("edit"),children:l.jsx(v,{})})},"2"));const t=[];return a.forEach(((e,s)=>{s&&t.push(l.jsx(c,{type:"vertical"},`line${s}`)),t.push(e)})),t}}],U=t.useMemo((()=>null==N?void 0:N.map(((e,s)=>{var a,t,i;const l=null==(a=null==e?void 0:e.version)?void 0:a.map((e=>`${e.prodname}(${e.versioncode})`));return{key:e.uuid,uuid:e.uuid,license:null==(t=null==e?void 0:e.codetoprovider)?void 0:t.regcode,product:l,store:(null==e?void 0:e.providername)||"-",storeId:(null==e?void 0:e.provideruuid)||"-",proxy:(null==e?void 0:e.agentinname)||"-",proxyId:(null==e?void 0:e.provideragentuuid)||"-",type:(null==e?void 0:e.providerlevel_name)||"",field:(null==e?void 0:e.stationname)||"",status:null==e?void 0:e.status,express:null==(i=null==e?void 0:e.codetoprovider)?void 0:i.statusreamk}}))),[k,N]),q={emptyText:y("noDataAvailable")};return l.jsxs("div",{className:"role-box",children:[l.jsxs("div",{className:"g-search",children:[S.includes("license:search")&&l.jsxs("ul",{className:"search-ul",children:[l.jsxs("li",{className:"search-item",children:[l.jsxs("span",{className:"item-lable",children:[y("agentName"),":"]}),l.jsx(o,{placeholder:y("pleaseSelect"),allowClear:!0,style:{width:"120px"},onChange:async e=>{var s;I({proxy:e,store:void 0});const a=null==(s=(await u.getStores({agenuuid:e})).data)?void 0:s.map((e=>({label:e.providername,value:e.uuid})));F(a)},value:z.proxy,options:T})]}),l.jsxs("li",{className:"search-item",children:[l.jsxs("span",{className:"item-lable",children:[y("storeName"),":"]}),l.jsx(o,{placeholder:y("pleaseSelect"),allowClear:!0,style:{width:"120px"},onChange:e=>{I({store:e})},value:z.store,options:A})]}),l.jsxs("li",{className:"search-item",children:[l.jsxs("span",{className:"item-lable",children:[y("activationStatus"),":"]}),l.jsxs(o,{placeholder:y("pleaseSelect"),allowClear:!0,style:{width:"120px"},onChange:e=>{I({status:e})},value:z.status,children:[l.jsx(j,{value:1,children:y("activate")}),l.jsx(j,{value:2,children:y("freeze")})]})]}),l.jsxs("li",{className:"search-item",children:[l.jsxs("span",{className:"item-lable",children:[y("storeType"),":"]}),l.jsx(o,{placeholder:y("pleaseSelect"),allowClear:!0,style:{width:"120px"},onChange:async e=>{I({type:e})},options:B,value:z.type})]})]}),l.jsx("ul",{className:"search-func",children:S.includes("license:search")&&l.jsx("li",{children:l.jsx(n,{type:"primary",icon:l.jsx(h,{}),disabled:!S.includes("license:search"),onClick:()=>{E(k)},children:y("search")})})})]}),l.jsx("div",{className:"diy-table",children:l.jsx(d,{columns:R,loading:b,locale:q,dataSource:U,pagination:{total:k.total,current:k.pageNum,pageSize:k.pageSize,showQuickJumper:!1,showTotal:e=>y("dataNumber",{count:e}),onChange:(e,s)=>((e,s)=>{E({pageNum:e,pageSize:s||k.pageSize})})(e,s)}})})]})}export{y as default};

import{u as e,g as a,r,j as s,S as o,k as i,B as l,n,m as c}from"./index-aeca932e.js";import{C as d}from"./index-d93151a5.js";import{F as u}from"./index-85dc0d3a.js";import{I as m}from"./index-d90fa46f.js";import{I as p}from"./index-a1eba122.js";/* empty css              */import{u as h}from"./user-a3dc1d16.js";import{t as j}from"./teacher-e39ee8aa.js";import{u as x}from"./useLocation-b24889d5.js";import{U as v}from"./index-af455608.js";import{U as g}from"./UploadOutlined-636e8664.js";import"./index-4a60c0a0.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./useForceUpdate-c2b76191.js";import"./DeleteOutlined-6b999003.js";function f(){const f=x(),w=e(),{model:b}=f.state;document.title="add"===b?"新增教练":"编辑教练";const[y]=u.useForm(),[I]=u.useForm();let[F,C]=a();const S=F.get("teacher"),[L,N]=r.useState([]),T=e=>new Promise(((a,r)=>{const s=new FileReader;s.onload=e=>{const s=new Image;s.onload=function(){const{width:e,height:r}=this;a(e/r==3/4)},s.onerror=r,s.src=e.target.result},s.onerror=r,s.readAsDataURL(e)})),[q,D]=r.useState([]),[O,U]=r.useState([]),P=async e=>{const a=(await h.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));U(a)};r.useEffect((()=>{(async()=>{const e=(await h.getAgents()).data.map((e=>({label:e.providername,value:e.uuid})));D(e)})(),(async()=>{const e=await j.getTeacherDetails({coachuuid:S});if(e&&200===e.code){const a=null==e?void 0:e.data;await P(null==a?void 0:a.provideruuid);const r=a.coachpic.split(",").map((e=>({uid:Date.now(),name:"image.png",status:"done",url:e})));N(r);const s={proxy:a.provideruuid,storeuuid:a.storeuuid,teacherName:null==a?void 0:a.coachname,StoreImg:null==a?void 0:a.coachpic,teacherPrice:null==a?void 0:a.coachprice,teacherDesc:a.coachintro,teacherTime:a.workingday.split(",")};y.setFieldsValue(s)}else c.error((null==e?void 0:e.msg)??t("dataFetchFailed"))})()}),[]);const[R,k]=r.useState();return s.jsx("div",{className:"field-edit-box",children:s.jsxs(u,{labelCol:{span:4},wrapperCol:{span:16},form:y,name:"control-hooks",onFinish:e=>{},style:{maxWidth:600},children:[s.jsx(u.Item,{name:"proxy",label:"所属代理",rules:[{required:!0}],children:s.jsx(o,{placeholder:"请选择代理",allowClear:!0,onChange:P,options:q})}),s.jsx(u.Item,{name:"storeuuid",label:"所属门店",rules:[{required:!0}],children:s.jsx(o,{placeholder:"请选择门店",onChange:async e=>{},options:O,allowClear:!0})}),s.jsx(u.Item,{name:"teacherName",label:"教练名称",rules:[{required:!0}],children:s.jsx(m,{maxLength:5,placeholder:"请输入"})}),s.jsx(u.Item,{name:"StoreImg",label:"教练图片",rules:[{required:!0}],children:s.jsx(v,{action:`${i}/service_api/file_upload`,accept:"image/*",fileList:L,maxCount:1,beforeUpload:async e=>{if(e.size>5242880)return c.error("图片不符合要求，请重新上传"),v.LIST_IGNORE;const a=await T(e);a||c.error("图片尺寸不符合要求，请重新上传");const r="image/png"===e.type||"image/jpg"===e.type;return a||v.LIST_IGNORE||r},onChange:({file:e,fileList:a})=>{if("uploading"!==e.status){const e=null==a?void 0:a.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(",");I.setFieldsValue({imageShow:e})}N(a)},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const r=new FileReader;r.readAsDataURL(e.originFileObj),r.onload=()=>a(r.result)})));const r=new Image;r.src=a;const s=window.open(a);null==s||s.document.write(r.outerHTML)},children:s.jsxs("div",{className:"uploadBox",children:[s.jsx(l,{icon:s.jsx(g,{}),children:"上传照片"}),s.jsx("span",{className:"tips",children:"最多可上传1份，大小不超过5M，尺寸竖版3：4，格式：jpg/png"})]})})}),s.jsx(u.Item,{name:"teacherPrice",label:"教练价格",rules:[{required:!0}],children:s.jsx(p,{style:{width:"100%"},placeholder:"请输入",addonAfter:"元/小时",min:0,value:R,onChange:e=>{k(e)},formatter:e=>/^(\-)*(\d+)\.(\d).*$/.test(e.toString())?parseFloat(e).toFixed(1):e,parser:e=>parseFloat(e)})}),s.jsx(u.Item,{name:"teacherDesc",label:"教练介绍",rules:[{required:!0}],children:s.jsx(m,{maxLength:30,placeholder:"请输入"})}),s.jsx(u.Item,{name:"teacherTime",label:"工作时间",rules:[{required:!0}],children:s.jsx(d.Group,{options:[{label:"周一",value:"1"},{label:"周二",value:"2"},{label:"周三",value:"3"},{label:"周四",value:"4"},{label:"周五",value:"5"},{label:"周六",value:"6"},{label:"周日",value:"7"}],onChange:()=>{}})}),s.jsxs(n,{className:"bottom-btn",children:[s.jsx(l,{type:"primary",className:"submit",onClick:async()=>{try{const e=await y.validateFields(),a={provideruuid:e.proxy,coachuuid:S,storeuuid:e.storeuuid,coachname:e.teacherName,coachintro:e.teacherDesc,coachpic:null==L?void 0:L.map((e=>{var a;return e.response?null==(a=null==e?void 0:e.response)?void 0:a.data[0]:e.url})).join(","),coachprice:e.teacherPrice,workingday:e.teacherTime.join(",")},r=await j.editTeacher(a);r&&200===r.code?(c.success("修改成功"),w("/store/teacher/list")):c.error((null==r?void 0:r.message)??"操作失败")}catch(e){}},children:"提交"}),s.jsx(l,{htmlType:"button",onClick:()=>{w(-1)},children:"返回"})]})]})})}export{f as default};

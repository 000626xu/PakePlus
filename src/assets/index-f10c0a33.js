import{r as e,A as s,_ as a,u as t,e as r,j as i,S as n,B as l,m as o,f as c,T as d,c6 as p}from"./index-aeca932e.js";import{a as u}from"./index-801a9590.js";import"./index-d93151a5.js";import{I as m}from"./index-d90fa46f.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{D as h}from"./index-a0588428.js";import{P as x}from"./index-60197fbb.js";import{u as j}from"./user-a3dc1d16.js";import{s as v}from"./store-77f5b287.js";import{s as y}from"./server-78efb863.js";import{u as g}from"./useSetState-8e08c7f5.js";import{S as f}from"./SearchOutlined-fa850377.js";import{D as w}from"./DisconnectOutlined-764e4556.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-4a60c0a0.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./responsiveObserve-cfbf1a72.js";import"./ActionButton-04036752.js";const N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"};var S=function(t,r){return e.createElement(s,a({},t,{ref:r,icon:N}))};const b=e.forwardRef(S);const k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M396 512a112 112 0 10224 0 112 112 0 10-224 0zm546.2-25.8C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM508 688c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z"}}]},name:"eye",theme:"filled"};var C=function(t,r){return e.createElement(s,a({},t,{ref:r,icon:k}))};const z=e.forwardRef(C),{Option:I}=n;function B(){document.title="服务管理";const s=t(),a=r((e=>e.app.powersCode)),N=r((e=>e.app.agentOpts)),[S,k]=e.useState([]),[C,B]=e.useState(!1),[O,E]=g({pageNum:1,pageSize:10,total:0}),[T,$]=g({name:void 0,proxy:void 0,store:void 0,cate:void 0,type:void 0}),L=async e=>{const s={page:e.pageNum,limit:e.pageSize,prodname:T.name,provideruuid:T.proxy,storeuuid:T.store,property:T.cate,status:T.type};B(!0);try{const a=await y.getServeList(s);a&&200===a.code?(k(a.data),E({total:a.cont,pageNum:e.pageNum,pageSize:e.pageSize})):o.error((null==a?void 0:a.message)??c("dataFetchFailed"))}finally{B(!1)}},M=(e,a)=>{s("see"===a?`/store/run/server/detail?id=${e.uuid}`:`/store/run/server/edit?id=${e.uuid}&model=2`)},[R,A]=e.useState([]),[D,F]=e.useState([]),Q={0:"拼场",2:"活动",3:"课程"},U=[{title:"编号",dataIndex:"key",key:"key"},{title:"分类",dataIndex:"property",key:"property",render:(e,s)=>i.jsx("span",{children:Q[s.property]})},{title:"服务名称",dataIndex:"prodname",key:"prodname"},{title:"所属门店",dataIndex:"storename",key:"storename"},{title:"所属代理",dataIndex:"providername",key:"providername"},{title:"所属场地",dataIndex:"stationname",key:"stationname"},{title:"价格",dataIndex:"price",key:"price"},{title:"库存",dataIndex:"currentcap",key:"currentcap",render:(e,s)=>i.jsxs("span",{children:[s.currentcap,"/",s.capacity]})},{title:"状态",dataIndex:"status",key:"status",render:(e,s)=>i.jsx("span",{children:0===s.status?"上架":"下架"})},{title:"服务时间",dataIndex:"showtime",key:"showtime"},{title:"创建时间",dataIndex:"addtime",key:"addtime",render:(e,s)=>i.jsx("span",{children:s.addtime})},{title:"操作",key:"control",width:150,render:(e,s)=>{const t=[];a.includes("server:switch")&&t.push(i.jsx("span",{className:"control-btn blue",onClick:()=>(async(e,s)=>{const a={produuid:s.uuid,status:1===e?0:1},t=await y.switchServe(a);t&&200===t.code&&(o.success(c("operationSuccessful")),L(O))})(s.status,s),children:i.jsxs(d,{placement:"top",title:"上下架",children:[" ",0===s.status?i.jsx(p,{type:"icon-xiajia"}):i.jsx(p,{type:"icon-a-shangjia2"})]})},"1")),a.includes("server:see")&&t.push(i.jsx("span",{className:"control-btn blue",onClick:()=>M(s,"see"),children:i.jsx(d,{placement:"top",title:"查看",children:i.jsx(z,{})})},"2")),a.includes("server:edit")&&t.push(i.jsx("span",{className:"control-btn blue",onClick:()=>M(s,"up"),children:i.jsx(d,{placement:"top",title:"编辑",children:i.jsx(b,{})})},"3")),a.includes("server:del")&&t.push(i.jsx(x,{title:"确定删除服务吗",onConfirm:()=>(async e=>{if(0===e.status)o.error("删除失败，请先下架服务");else{const s={produuid:e.uuid,status:2},a=await y.switchServe(s);a&&200===a.code?(o.success(c("operationSuccessful")),L(O)):o.error((null==a?void 0:a.message)??"操作失败")}})(s),okText:"确定",cancelText:"取消",children:i.jsx("span",{className:"control-btn blue",children:i.jsx(w,{})},"4")},5));const r=[];return t.forEach(((e,s)=>{s&&r.push(i.jsx(h,{type:"vertical"},`line${s}`)),r.push(e)})),r}}],q=e.useMemo((()=>S.map(((e,s)=>({key:e.id,uuid:e.uuid,property:e.property,prodname:e.prodname,storename:e.storename,providername:null==e?void 0:e.providername,stationname:null==e?void 0:e.stationname,price:null==e?void 0:e.price,capacity:null==e?void 0:e.capacity,currentcap:null==e?void 0:e.currentcap,showtime:null==e?void 0:e.showtime,addtime:null==e?void 0:e.addtime,status:null==e?void 0:e.status})))),[O,S]);return e.useEffect((()=>{L(O),(async()=>{const e=(await v.getStoreType()).data.map((e=>({label:e.name,value:e.id})));F(e)})()}),[]),i.jsxs("div",{className:"role-box",children:[i.jsxs("div",{className:"g-search",children:[a.includes("server:search")&&i.jsxs("ul",{className:"search-ul",children:[i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"70px"},children:"服务名称:"}),i.jsx(m,{placeholder:"请输入服务名称",value:T.name,onChange:e=>$({name:e.target.value}),style:{width:"120px"}})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择代理:"}),i.jsx(n,{placeholder:"请选择代理",allowClear:!0,style:{width:"120px"},onChange:async e=>{$({proxy:e,store:""});const s=(await j.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));A(s)},value:T.proxy,options:N})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择门店:"}),i.jsx(n,{placeholder:"请选择门店",allowClear:!0,style:{width:"120px"},onChange:e=>{$({store:e})},value:T.store,options:R})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择分类:"}),i.jsxs(n,{placeholder:"请选择分类",allowClear:!0,style:{width:"120px"},onChange:e=>{$({cate:e})},value:T.cate,children:[i.jsx(I,{value:0,children:"拼场"}),i.jsx(I,{value:2,children:"活动"}),i.jsx(I,{value:3,children:"课程"})]})]}),i.jsxs("li",{className:"search-item",children:[i.jsx("span",{className:"item-lable",style:{width:"70px"},children:"门店类型:"}),i.jsx(n,{placeholder:"请选择门店类型",allowClear:!0,style:{width:"120px"},onChange:async e=>{$({type:e})},options:D,value:T.type})]})]}),i.jsx("ul",{className:"search-func",children:a.includes("server:search")&&i.jsx("li",{children:i.jsx(l,{type:"primary",icon:i.jsx(f,{}),disabled:!a.includes("server:search"),onClick:()=>{L(O)},className:"searchBtn",children:"搜索"})})})]}),i.jsx("div",{className:"secondRow",children:a.includes("server:add")&&i.jsx(l,{type:"primary",disabled:!a.includes("server:add"),onClick:()=>{s("/store/run/server/add")},className:"addBtn",children:"新增服务"})}),i.jsx("div",{className:"diy-table",children:i.jsx(u,{columns:U,loading:C,dataSource:q,pagination:{total:O.total,current:O.pageNum,pageSize:O.pageSize,showQuickJumper:!1,showTotal:e=>`共 ${e} 条数据`,onChange:(e,s)=>((e,s)=>{L({pageNum:e,pageSize:s||O.pageSize})})(e,s)}})})]})}export{B as default};

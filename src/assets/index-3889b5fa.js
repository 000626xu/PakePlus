import{a1 as e,u as s,e as a,r as t,h as i,j as l,S as d,B as r,a2 as n,m as c,f as o}from"./index-aeca932e.js";import{D as u}from"./index-d88d2b2a.js";import"./index-57f63cdf.js";import{u as m}from"./user-a3dc1d16.js";import{T as p}from"./TextArea-a18ea7e9.js";import{u as h}from"./useSetState-8e08c7f5.js";import{M as x}from"./index-6226197c.js";import"./CalendarOutlined-8ff6678f.js";import"./index-73995e0d.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";import"./getScrollBarSize-6b2349d8.js";const j={getDataByStore:s=>e({url:"service_api/product_station_time",method:"get",params:s}),getDataByField:s=>e({url:"service_api/product_station_list",method:"get",params:s}),getFieldByStore:s=>e({url:"service_api/statione_select",method:"get",params:s}),upField:s=>e({url:"service_api/station_up",method:"post",data:s}),downField:s=>e({url:"service_api/station_down",method:"post",data:s}),delServe:s=>e({url:"service_api/edit_product_status",method:"post",data:s})};function v(){document.title="运营管理";const e=s(),v=a((e=>e.app.powersCode)),y=a((e=>e.app.agentOpts)),[N,w]=h({proxy:void 0,store:void 0,field:void 0,date:void 0}),[f,g]=t.useState(!0),S=async e=>{w({store:e});const s=(await j.getFieldByStore({provideruuid:e})).data.map((e=>({label:e.stationname,value:e.uuid})));C(s)},[B,C]=t.useState([]),[b,k]=t.useState([]),[_,$]=t.useState(i()),[D,F]=t.useState([]),[Y,T]=t.useState({}),[M,O]=t.useState({}),[A,E]=h({reson:"",desc:""}),[H,z]=t.useState(24),[P,W]=t.useState(!1),[X,Z]=t.useState(!1),[q,G]=t.useState([]),I=async()=>{let e;if(e=f?await j.getDataByStore({storeuuid:N.store,time:N.date}):await j.getDataByField({stationuuid:N.field,time:N.date}),200===e.code){const s=e.data;G(s),F([]),T({})}},J=["","周一","周二","周三","周四","周五","周六","周日"];return t.useEffect((()=>{(async()=>{const e=y[0].value,s=await m.getStores({agenuuid:e}),a=s.data.map((e=>({label:e.providername,value:e.uuid})));k(a);const t=s.data[0].uuid;S(t);const l=i().format("YYYY-MM-DD");w({proxy:e,store:t,date:l});const d=await j.getDataByStore({storeuuid:t,time:l});if(200===d.code){const e=d.data;G(e),F([]),T({})}})()}),[]),l.jsxs("div",{className:"runBox",children:[l.jsxs("div",{className:"g-search",children:[v.includes("run:search")&&l.jsxs("ul",{className:"search-ul",children:[l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择代理:"}),l.jsx(d,{placeholder:"请选择代理",allowClear:!0,style:{width:"180px"},onChange:async e=>{w({proxy:e,store:""});const s=(await m.getStores({agenuuid:e})).data.map((e=>({label:e.providername,value:e.uuid})));k(s)},value:N.proxy,options:y})]}),l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择门店:"}),l.jsx(d,{placeholder:"请选择门店",allowClear:!0,style:{width:"180px"},onChange:S,value:N.store,options:b})]})]}),l.jsxs("ul",{className:"search-func",children:[v.includes("run:search")&&l.jsx("li",{children:l.jsx(r,{type:"primary",disabled:!v.includes("run:search"),className:"searchBtn",onClick:()=>g(!0),children:"按日期展示"})}),v.includes("run:search")&&l.jsx("li",{children:l.jsx(r,{type:"primary",disabled:!v.includes("run:search"),className:"addBtn",onClick:()=>g(!1),children:"按场地展示"})})]})]}),l.jsxs("div",{className:"syncSearch",children:[v.includes("run:search")&&l.jsxs("ul",{className:"search-ul",children:[!f&&l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择场地:"}),l.jsx(d,{placeholder:"请选择场地",allowClear:!0,style:{width:"180px"},onChange:async e=>{w({field:e})},value:N.field,options:B})]}),l.jsxs("li",{className:"search-item",children:[l.jsx("span",{className:"item-lable",style:{width:"70px"},children:"选择日期:"}),l.jsx(u,{onChange:(e,s)=>{w({date:s}),$(e)},value:_,format:"YYYY-MM-DD"})]}),v.includes("run:search")&&l.jsx("li",{children:l.jsx(r,{type:"primary",disabled:!v.includes("run:search"),className:"searchBtn",onClick:I,children:"查询"})})]}),l.jsxs("ul",{className:"search-func",children:[v.includes("run:switch")&&3===Y.status&&l.jsx("li",{children:l.jsx(r,{type:"primary",className:"addBtn",onClick:async()=>{const e={produuid:Y.produuid,status:0},s=await j.upField(e);s&&200===s.code&&(c.success(o("operationSuccessful")),I())},children:"上架"})}),v.includes("run:switch")&&0===Y.status&&"0"!==Y.explain&&l.jsxs("li",{children:[l.jsx(r,{type:"primary",className:"addBtn",onClick:()=>{e("/store/run/server/add")},children:"新增服务"}),l.jsx(r,{type:"primary",disabled:!v.includes("run:switch"),className:"addBtn",onClick:()=>{Z(!0)},children:"下架"})]}),v.includes("license:search")&&2===Y.status&&l.jsx("li",{children:l.jsx(r,{type:"primary",disabled:!v.includes("license:search"),className:"addBtn",onClick:()=>{e(`/store/run/server/edit?id=${Y.produuid}&model=2`)},children:"编辑服务"})}),v.includes("run:del")&&2===Y.status&&l.jsx("li",{children:l.jsx(r,{type:"primary",disabled:!v.includes("run:del"),className:"addBtn",onClick:()=>{W(!0)},children:"删除服务"})}),v.includes("run:detail")&&1===Y.status&&l.jsx("li",{children:l.jsx(r,{type:"primary",disabled:!v.includes("run:detail"),className:"addBtn",onClick:()=>{e(`/order/detail?order=${null==Y?void 0:Y.produuid}`)},children:"查看订单"})})]})]}),l.jsxs("div",{className:"tableBox",children:[l.jsxs("div",{className:"labelBox",children:[l.jsx("div",{className:"labelTxt"}),Array.from({length:H},((e,s)=>l.jsxs("div",{className:"labelTxt",children:[s>9?s:"0"+s,":00"]},s)))]}),l.jsx("div",{className:"dataBox",children:null==q?void 0:q.map(((e,s)=>l.jsxs("div",{className:"playground",children:[l.jsx("div",{className:"Dataheader",children:e.stationname?e.stationname:l.jsxs("div",{className:0===s?"dateHeader red":"dateHeader",children:[l.jsx("div",{className:"week",children:J[e.week]}),l.jsx("div",{className:"date",children:e.time})]})}),e.weekarr.map(((a,t)=>{return l.jsx("div",{className:n(D,[t+1,s+1])?"data active":"data cell",style:{backgroundColor:(i=a.explain,d=a.status,"0"!==i&&0===d?"#baddf4":0===d?"#F7F7F7":1===d?"#EA9092":2===d?"#8EE1B0":3===d?"#FDFDC3":void 0)},onClick:()=>{return i=t+1,l=s+1,r=e,void("0"===(d=a).explain&&0===d.status||(T(d),O(f?r:{stationuuid:N.field,time:r.time}),n(D,[i,l])?F([]):F([i,l])));var i,l,d,r},children:"0"===a.explain&&0===a.status?"无服务":0===a.status&&"0"!==a.explain?"¥"+a.explain:a.explain},t);var i,d}))]},s)))})]}),l.jsx(x,{title:"删除服务",open:P,okText:"确认删除",onOk:async()=>{W(!1);const e=await j.delServe({produuid:Y.produuid,status:2});e&&200===e.code?(c.success(o("operationSuccessful")),I()):c.error(e.msg)},centered:!0,onCancel:()=>{W(!1)},children:l.jsx("div",{children:"服务删除后将无法恢复，是否确认删除该服务！"})}),l.jsx(x,{title:"下架场地",open:X,okText:"确认",onOk:()=>{(async()=>{const e=Y.hour-1<10?`0${Y.hour-1}:00:00`:Y.hour-1+":00:00",s=Y.hour<10?`0${Y.hour}:00:00`:`${Y.hour}:00:00`;let a="",t="";f?(a=`${N.date} ${e}`,t=`${N.date} ${s}`):(a=`${M.time} ${e}`,t=`${M.time} ${s}`);const i={provideruuid:N.proxy,storeuuid:N.store,stationuuid:M.stationuuid,property:A.reson,prodintro:A.desc,regtime:a,offtime:t},l=await j.downField(i);l&&200===l.code&&(c.success(o("operationSuccessful")),I())})(),Z(!1)},centered:!0,onCancel:()=>{Z(!1)},children:l.jsxs("div",{className:"downBox",children:[l.jsxs("div",{className:"reson",children:[l.jsx("span",{children:"下架原因"}),l.jsx(d,{style:{width:120},onChange:e=>{E({reson:e})},options:[{value:"94",label:"下架:维护"},{value:"95",label:"下架:占用"},{value:"96",label:"下架:其他"}]})]}),l.jsxs("div",{className:"desc",children:[l.jsx("div",{children:"说明原因(选填)"}),l.jsx(p,{className:"descTxt",onChange:e=>{E({desc:e.target.value})},rows:6,placeholder:"请填写具体原因"})]})]})})]})}export{v as default};

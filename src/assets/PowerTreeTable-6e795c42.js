import{b as e,r as t,c as s,l as n,j as i,i as r}from"./index-aeca932e.js";import{S as a,a as d}from"./index-801a9590.js";import{C as o}from"./index-d93151a5.js";import"./index-d90fa46f.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{M as l}from"./index-6226197c.js";function c(c){const{t:p}=e(),[m,u]=t.useState([]),[f,x]=t.useState([]);t.useEffect((()=>{u(c.defaultChecked.menus||[]),x(c.defaultChecked.powers||[])}),[c.defaultChecked]);const h=t.useCallback((()=>{var e;const t=[1,6,...m];null==(e=c.onOk)||e.call(c,{menus:t,powers:f})}),[c,f,m]),w=t.useCallback((()=>{c.onClose()}),[c]),k=t.useCallback((e=>!!f.find((t=>t===e))),[f]),j=t.useCallback(((e,t,n)=>{const i=[...f];let r=[...m];const a=s.getPowerById({id:t}),d=a.data[0].urlId?a.data[0].urlId:-1;if(e.target.checked)i.push(t),r=Array.from(new Set(-1!==d?[n.id,d,...m]:[n.id,...m]));else{i.splice(i.indexOf(t),1);const e=n.powers.map((e=>e.id));f.some((s=>s!==t&&e.indexOf(s)>=0))||(r.splice(r.indexOf(n.id),1),-1!==d&&r.splice(r.indexOf(d),1))}x(i),u(r)}),[f,m]),y=t.useCallback(((e,t)=>{let s;return s=e?t.filter((t=>t.parent===e.id)):t.filter((e=>!e.parent)),s.forEach((e=>{e.children=y(e,t),e.key=e.id})),s.length?s:void 0}),[]),g=t.useCallback((e=>{const t=[];for(let s=0;s<e.length;s++){const n={...e[s]};n.children&&(n.children=g(n.children));const i={...n,key:n.id};!n.hidden&&t.push(i)}return t}),[]),C=t.useMemo((()=>{const e=n.cloneDeep(c.data),t=g(e);t.sort(((e,t)=>e.sorts-t.sorts));return y(void 0,t)||[]}),[c.data,y]),S=t.useMemo((()=>({onSelect:(e,t)=>{const s=c.data.find((t=>t.id===e.id));if(t){if(s&&Array.isArray(s.powers)){const e=Array.from(new Set([...s.powers.map((e=>e.id)),...f]));x(e);const t=Array.from(new Set([...s.powers.map((e=>e.urlId?e.urlId:-1)),s.id,...m]));u(t)}}else if(s&&Array.isArray(s.powers)){const e=s.powers.map((e=>e.id)),t=f.filter((t=>e.indexOf(t)<0));x(t);const n=Array.from(new Set([...s.powers.map((e=>e.urlId?e.urlId:-1)),s.id])),i=m.filter((e=>n.indexOf(e)<0));u(i)}},selectedRowKeys:m})),[c.data,m,f]),I=t.useMemo((()=>[{title:p("menu"),dataIndex:"title",key:"title",width:"30%",render:(e,t)=>i.jsx("span",{className:"menuTitle",children:p(e)})},{title:p("permissions"),dataIndex:"powers",key:"powers",width:"70%",render:(e,t)=>e?e.map(((e,s)=>i.jsx(o,{checked:k(e.id),onChange:s=>j(s,e.id,t),children:i.jsx("span",{className:"powerTitle",children:p(e.title)})},s))):null}]),[k,j,r.language]);return i.jsx(l,{className:"menu-tree-table",zIndex:1001,width:750,title:c.title||"请选择",open:c.modalShow,okText:p("confirm"),cancelText:p("cancel"),onOk:h,onCancel:w,confirmLoading:c.loading,children:c.initloading?i.jsx("div",{style:{textAlign:"center"},children:i.jsx(a,{tip:p("loading")})}):i.jsx(d,{columns:I,rowSelection:S,dataSource:C,pagination:!1})})}export{c as T};

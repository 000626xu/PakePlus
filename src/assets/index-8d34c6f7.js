import{b as e,u as a,g as t,e as s,r as i,j as o,B as l,m as n,k as r,ca as c}from"./index-aeca932e.js";import{F as d}from"./index-85dc0d3a.js";import{I as m}from"./index-d90fa46f.js";import{a as p}from"./index-801a9590.js";import"./index-d93151a5.js";import"./index-5a025839.js";import"./index-fb057fd6.js";import{D as u}from"./index-a0588428.js";import{P as A}from"./index-60197fbb.js";/* empty css              */import{h as f}from"./hado-2bd80816.js";import{u as g}from"./useSetState-8e08c7f5.js";import{M as x}from"./index-6226197c.js";import{U as h}from"./index-af455608.js";import{U as j}from"./UploadOutlined-636e8664.js";import"./responsiveObserve-cfbf1a72.js";import"./index-73995e0d.js";import"./EyeOutlined-f0ed5c3d.js";import"./index-5bcf51a7.js";import"./getScrollBarSize-6b2349d8.js";import"./isEqual-89fb4070.js";import"./useForceUpdate-c2b76191.js";import"./index-4a60c0a0.js";import"./ActionButton-04036752.js";import"./Portal-0dc81ff6.js";import"./DeleteOutlined-6b999003.js";const y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAANVJREFUKFNjZCASMPLz86cwMjLGMTAw7MOhx+n///+LGBkYGBgFBAR2cXFx+T979uwbsmIpKSmub9++bfzw4YMbSCEDHx+fGTMzc/D79+/LkRUKCgp2/v37d+2nT59OgRWCgICAwDxGRsaG9+/fPwLxBQUF5f7//9/w4cOHJBAfrlBERETy79+//e/fv4+AKlzBzMxc+ObNm+coCkEcfn5+kNXnoJYYffz4sRNmI9xEqACbgIDAGhD7w4cPIQwMDL9wKQS5zRsk+f79+63IHkM3EWfwAwAFSkOd6BJM9AAAAABJRU5ErkJggg==",w="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAJpJREFUKFON0DsOwjAMBuA/kdjt7Ews3IJyDEbKMWCEY9CVY1BuwcLEHmevlNBUSQWIAJn8+GRbUURE+OMpIloDaH7YWkVARGcAVQG3zrllhosetgVY9fAywDT1CKB+w41zbhNrIzTGTL33NwCThDut9cxae3+BMWHmbQhhPzSU2onIIW8YJ+YCM19jLCLz5zM+wVWCp6+w9J8P0AAp3PN+ijYAAAAASUVORK5CYII=",{TextArea:S}=m;function N(){const{t:m}=e();document.title="HADO CRM";const N=a();let[b,C]=t();const k=b.get("id"),I=b.get("title"),T=s((e=>e.app.powersCode)),[F]=d.useForm(),[z,U]=i.useState([]),[D,E]=i.useState(!1),[v,R]=i.useState(1),[M,B]=i.useState(0),[L,O]=g({pageNum:1,pageSize:10,total:0}),[Y,G]=g({operateType:"up",nowData:null,modalShow:!1,modalLoading:!1});document.querySelector("#root > section > section > div > nav > ol > li:nth-child(2) > span.ant-breadcrumb-link").innerHTML=I;const J={fileUp:[],fileInfo:""},K=()=>{G({modalShow:!1}),F.setFieldsValue({...J}),W([])},V=async(e,a,t)=>{const s={page:e.pageNum,limit:e.pageSize,filetype:k,addtimesort:a,updatedsort:t};E(!0);try{const a=await f.editConfig(s);a&&200===a.code?(U(a.data),O({total:a.cont,pageNum:e.pageNum,pageSize:e.pageSize})):n.error((null==a?void 0:a.message)??m("dataFetchFailed"))}finally{E(!1)}},P=[{title:m("number"),dataIndex:"serial",key:"serial"},{title:m("fileName"),dataIndex:"fileName",key:"fileName",render:(e,a)=>o.jsxs(o.Fragment,{children:[a.fileName,1==a.status?o.jsx("span",{style:{color:"red",paddingLeft:"5px"},children:m("latestSync")}):o.jsx(o.Fragment,{})]})},{title:m("fileDescription"),dataIndex:"tableDesc",key:"tableDesc"},{title:o.jsxs("div",{onClick:()=>{R((e=>e?0:1))},children:[m("creationTime"),o.jsx("img",{src:v?w:y,alt:"",style:{marginLeft:"5px"}})]}),dataIndex:"createTime",key:"createTime"},{title:o.jsxs("div",{onClick:()=>{B((e=>e?0:1))},children:[m("syncTime"),o.jsx("img",{src:M?w:y,alt:"",style:{marginLeft:"5px"}})]}),dataIndex:"syncTime",key:"syncTime"},{title:m("action"),key:"control",width:200,render:(e,a)=>{const t=[];T.includes("hado:sync")&&t.push(o.jsx("span",{className:"control-btn blue",onClick:()=>(async e=>{E(!0);try{const a=await f.syncConfig({id:e.key});a&&200===a.code?(n.success(m("syncSuccess")),V(L,v,M)):n.error("校验失败，无法完成同步")}finally{E(!1)}})(a),children:m("sync")},"1")),T.includes("hado:download")&&t.push(o.jsx("span",{children:o.jsx("a",{href:a.url,download:a.fileName,className:"control-btn blue",children:m("downloadCSV")})},"2")),T.includes("hado:del")&&t.push(o.jsx(A,{title:m("delete"),onConfirm:()=>(async e=>{E(!0);try{const a=await f.deleteConfig({id:e.key});a&&200===a.code?(n.success("删除成功"),1===z.length&&L.pageNum>1?V({pageNum:L.pageNum-1,pageSize:L.pageSize},v,M):V(L,v,M)):n.error((null==a?void 0:a.message)??"操作失败")}finally{E(!1)}})(a),okText:m("confirm"),cancelText:m("cancel"),children:o.jsx("span",{className:"control-btn blue",children:m("delete")})},"3"));const s=[];return t.forEach(((e,a)=>{a&&s.push(o.jsx(u,{type:"vertical"},`line${a}`)),s.push(e)})),s}}],Q=i.useMemo((()=>z.map(((e,a)=>({key:e.id,uuid:e.useruuid,serial:a+1+(L.pageNum-1)*L.pageSize,fileName:e.filename,tableDesc:e.filedescription,createTime:e.addtime,syncTime:e.updated,status:e.status,url:e.filelocation})))),[L,z]),[H,W]=i.useState([]),_={accept:".csv",action:r+"/service_api/hadoworld_upload_file",onRemove:e=>{const a=H.indexOf(e),t=H.slice();t.splice(a,1),W(t)},beforeUpload:e=>(W([...H,e]),!1),fileList:H,maxCount:1};i.useEffect((()=>{1===v&&B(0)}),[v]),i.useEffect((()=>{1===M&&R(0)}),[M]),i.useEffect((()=>{V(L,v,M)}),[v,M]);const q={emptyText:m("noDataAvailable")};return o.jsxs("div",{className:"gameList",children:[o.jsxs("div",{className:"btnBox",children:[T.includes("hado:upload")?o.jsx(l,{type:"primary",ghost:!0,className:"btn",onClick:()=>{G({modalShow:!0,nowData:null,operateType:"up"})},children:m("uploadFile")}):o.jsx(o.Fragment,{}),o.jsx(l,{type:"primary",ghost:!0,className:"btn",onClick:()=>{N("/game/list")},children:m("return")})]}),o.jsx("div",{className:"diy-table",children:o.jsx(p,{columns:P,loading:D,locale:q,dataSource:Q,pagination:{total:L.total,current:L.pageNum,pageSize:L.pageSize,showQuickJumper:!1,showTotal:e=>m("dataNumber",{count:e}),onChange:(e,a)=>((e,a)=>{V({pageNum:e,pageSize:a||L.pageSize},v,M)})(e,a)}})}),o.jsx(x,{title:m("uploadFile"),open:Y.modalShow,onOk:async()=>{try{const e=await F.validateFields();if(G({modalLoading:!0}),"up"===Y.operateType)try{const a=H[0],t=await(e=>new Promise(((a,t)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>a(s.result),s.onerror=e=>t(e)})))(a),s=((e,a)=>{const t=e.split(","),s=t[0].match(/:(.*?);/)[1],i=atob(t[1]),o=i.length,l=new Uint8Array(o);for(let d=0;d<o;d++)l[d]=i.charCodeAt(d);const n=a.lastIndexOf("."),r=a.slice(0,n),c=a.slice(n+1);return new File([l],`${r}.${c}`,{type:s})})(t,a.name);let i=new FormData;i.append("file",s),i.append("filetype",k),i.append("filedescription",e.fileInfo),(e=>{var a={method:"post",url:r+"/service_api/hadoworld_upload_file",headers:{Authorization:localStorage.getItem("token")},data:e};return c(a)})(i).then((e=>{const a=e.data;a&&200===a.code?(n.success("添加成功"),V(L,v,M),K()):n.error((null==a?void 0:a.msg)??m("dataFetchFailed"))})).catch((e=>(n.error(e.message),Promise.reject(e))))}finally{G({modalLoading:!1})}V(L,v,M)}catch{}},onCancel:K,okText:m("uploadFile"),cancelText:m("cancel"),children:o.jsxs(d,{form:F,children:[o.jsx(d.Item,{name:"fileUp",label:m("uploadFile"),rules:[{required:!0,message:m("pleaseUpload")}],children:o.jsx(h,{..._,children:0===H.length?o.jsx(l,{icon:o.jsx(j,{}),children:m("uploadFile")}):null})}),o.jsx(d.Item,{name:"fileInfo",label:m("fileDescription"),rules:[{required:!0,message:m("pleaseEnter")}],children:o.jsx(S,{})})]})})]})}export{N as default};
